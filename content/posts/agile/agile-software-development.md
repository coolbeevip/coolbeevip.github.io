---
title: "敏捷之为什么我不用 GitFlow"
date: 2022-05-11T00:24:14+08:00
tags: []
categories: [agile]
draft: true
---

## 敏捷工作流程的简要回顾

> 敏捷提倡增量和迭代开发。与仅在最后一个阶段完成后才通过每个阶段（设计/实施/测试/部署）的传统项目生命周期不同，敏捷倡导团队将项目分解为更小的“部分”或任务，并经历整个生命周期对于每件作品，不断推出功能，而不是一次全部推出

#### GitFlow 的简要回顾

开发项目中不同功能的开发人员需要一种将所有这些不同的源代码组合到一个代码库中的方法。此外，合并代码库不应干扰其他代码库（开发人员协作的恐怖故事源源不断！）。正如其创建者 Vincent Driessen 所描述的，GitFlow 是一个“去中心化但集中化”的存储库设置。

每个存储库至少有两个版本：“主分支”上的版本和“开发分支”上的版本。开发人员从不直接在主分支之外工作。此外，通过将开发分支上的代码版本复制到实际设计/实现源代码的新“功能分支”来创建新功能。一旦功能经过测试和批准，所有反映在开发分支上的更改都可以替换主分支并进行部署。

这种直观的策略允许开发团队 1. 跟踪项目时间线中的所有更改，2. 轻松回滚对代码库以前版本的更改，以及 3. 一次同时处理不同的功能。

**如果您有兴趣了解有关 GitFlow 的更多信息，请查看 Vincent Driessen 解释 GitFlow 分支和合并策略的原始博文**

在敏捷团队中使用 GitFlow 的担忧与任何一种个人策略都没有多大关系。两者的原则都相对简单，并且很容易集成到现有的 DevOps 团队中。一些著名的公司，比如 Atlassian，发誓在他们的敏捷团队中使用 GitFlow。但这远非行业标准。主要问题是 GitFlow 在逻辑上与敏捷的轻量级和迭代过程相矛盾。 看一下 GitFlow 原型模型

乍一看，它的工作原理并不十分明显，是吗？


GitFlow 令人困惑 目前尚不清楚实施或部署点在哪里。更不用说，您甚至可能需要一段时间才能找到开发分支的位置（它是黄色分支）。 GitFlow 添加的功能和分支越多，就越复杂和混乱。正如古老的格言所说，“KISS：保持简单，愚蠢”。随着应用程序变得越来越复杂，DevOps 团队越来越远程和自主，以及像微服务这样的设计越来越流行，GitFlow 的价值迅速下降。它很容易出错，而且很难看出敏捷方法适合什么地方。


## GitFlow 与敏捷自相矛盾

对于敏捷方法而言，团队的工作流程必须是增量的和迭代的。然而，GitFlow 违反了这些基本原则。如果您在*图 2* 中跟踪 GitFlow 模型中的开发分支，您会看到在项目周期开始时添加了一个新功能分支。然后，在与开发分支（所有开发人员工作的地方）实施之前，它会经历一个完整的设计阶段，以便可以开始测试和错误修复。批准的功能最终被部署并与主分支合并

虽然这个过程听起来与敏捷非常相似，但它实际上是项目管理的瀑布方法*参见图 1*。如果不断鼓励开发人员“完成”一个功能，那么维持持续部署是极其困难的；合并该功能意味着手动将开发分支上的所有更改推送到主分支进行部署。这种过程没有任何增量

## 如果 GitFlow 出局了

完全打折 GitFlow 可能太仓促了。正如本博客开头所述，一些公司发现这种设置很有价值。但是，如果您的敏捷团队正在使用 GitFlow，并且之前的担忧引起了您的共鸣，那么行业专业人士正在转向以下替代方案

#### [Feature Branching](https://docs.microsoft.com/en-us/azure/devops/repos/git/git-branching-guidance?view=azure-devops)

这种策略将分支流程简化为只有两个分支：一个主分支和一个特征。在销毁分支并开始下一个功能之前，会创建、完成和部署一个功能。它坚持使分支保持短暂和相互隔离的原则（避免过程中的合并冲突）

这种策略的缺点是，在合并之前，您永远无法确定您的功能代码是否仍与主分支兼容。它还需要开发人员之间更多的协调和依赖，以避免合并冲突并决定以什么顺序实现哪些功能。

#### [Trunk-Based Development](https://launchdarkly.com/blog/introduction-to-trunk-based-development/)

对于经验丰富的 DevOps 团队，此策略涉及直接在主分支上进行更改，并在整个项目生命周期中不断将小的更改或功能标志推送到主分支。在使用短期分支时，它甚至比功能分支更好。此外，开发人员可以更自由地将不完整的功能合并到代码库中，从而满足增量敏捷原则。

直接在主分支上工作本质上是有风险的，因此初级开发人员可能不应该尝试基于主干的策略。不仅项目的生命线暴露出来，而且在部署后很难配置一个程序来向最终用户隐藏不完整的功能。开发人员还需要经验和更高的意识来组织功能标志并在它们开始构建之前解决它们。


## 是否有适合所有人的灵丹妙药策略?

不幸的是，没有“最佳分支策略”。无论您的团队实施何种策略，都高度依赖于您的特定需求。如果您正在选择实施策略，请记住以下问题

1. 这种分支策略将解决什么问题？
2. 会产生什么问题？
3. 您的团队更喜欢如何发布代码？一天几次？每月一次？什么时候准备好？
4. 采用此策略将如何改变您团队的开发行为？

## QA

fork: 跨组织协同



* 先培养文化，后关心代码
* 方法论
  * 内源如何开始，反例

* 异步和远程工作
  * 更数字化的协作，而无需参与者位于相同的时区或位置
  * 所有沟通，开发（代码提交，issue 管理和代码审查），QA 和发布管理通常可以完全以在线的方式在任何时区进行
  * 不定期进行面对面的迭代/会议的异步方法是一种非常高效的方法

* 同行评审和工作流程
  * 日常协作中有两个重要原则。首先，所有贡献都由其他开发者审查（包括新功能和 Bug 修复
  * 其次，同行评审是公开进行，可供其他人查看的（尴尬）
  * 其中很大一部分仍是培养一种文化，在这种文化中，我们欢迎批评，庆祝失败
  * 我们珍惜能帮助我们更好做事的同事

在同行评审和工作流程中，有两种行为经济学原理起着关键作用。

首先是宜家效应：如果你和我将完全相同的宜家桌子组装在一起（或组装其他东西），我们都会认为我们各自的桌子在某种程度上会更好或更有价值。因此，我们对自己的工作中增加了额外的价值，这种价值通常是高估了了的。  

其次是自治原则。从本质上讲，选择对人们至关重要，如果我们觉得自己无法控制自己的命运，无法做出选择，那我们就会感到束手无策。

仅这两个原则就对工作流程和同行评审产生重要影响。在宜家效应方面，我们应预估大多数人的 PR 和修正对他们自己来说非常有价值。因此，我们需要使用同行评审，以一种独立且不掺杂感情的方式客观地定义贡献的价值（例如，评审差异的特定部分，需要至少两名评审，鼓励具体的实施反馈，等等）。遵循自治原则方面，我们应确保员工可以尽可能地完善、自定义其工具链和工作流程，并定期给他们提供反馈和意见机会。


* 声望、激励和参与

在公司中建立内源文化的另一个关键要素是仔细研究如何跟踪优秀的工作并激励和鼓励这种行为。

这部分内容由三个核心组成。

首先，我们需要有一种方法来定量表示成员的工作质量。这可能涉及到建立一个复杂的系统来跟踪个人行为并衡量其价值，或者简单到只去观察他们是如何工作的。在这里，重要的是人们应该根据他们的价值来评价，而不是他们与老板有多少交际，或者他们带了多少甜甜圈到办公室这样的因素。

其次，基于他们的工作表现，我们需要提供不同的激励和奖励来鼓励我们想要看到的行为。

奖励有两种核心类型。外部奖励本质上是实质性的，例如T恤、帽衫、礼品卡、金钱等。内在奖励是更感性的，例如尊重、认可和钦佩。两者都很重要，重要的是在这些奖励之间取得适当的平衡。基于你想要鼓励的行为，我建议将激励措施和奖励措施结合起来。

最后，根据员工的工作情况将他们细分为不同的小组，并以不同的方式让他们参与进来，这是很有帮助的。例如，新人将从指导、支持和更广泛的引导中受益。另一方面，最活跃和最有成就的员工可以成为洞察和指导的巨大源泉，他们可以在帮助进一步塑造公司文化方面发挥作用。

## 参考资料

[How to create an internal innersource community](https://opensource.com/life/16/11/create-internal-innersource-community)
[内源社区组建经验谈](https://blog.csdn.net/ZicoChan/article/details/105516101)

版本经理？
