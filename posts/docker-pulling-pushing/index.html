<!doctype html><html lang=en data-theme><head><title>Lei Zhang | Docker Pulling Pushing Batch Shell Script</title><meta charset=utf-8><meta name=generator content="Hugo 0.83.1"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="This is my knowledge base. I document things here"><link rel=stylesheet href=/css/style.min.7cf3c5090ac13256a5fa5531e5649cfe5a2ba7de88dca14ce0b6e253409a3511.css integrity="sha256-fPPFCQrBMlal+lUx5WSc/lorp96I3KFM4LbiU0CaNRE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.f856cb76c8381a437165165d0265ca1d221f2441b9d80f02627f02fed271048d.css integrity="sha256-+FbLdsg4GkNxZRZdAmXKHSIfJEG52A8CYn8C/tJxBI0=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=/posts/docker-pulling-pushing/><script type=text/javascript src=/js/anatole-header.min.0c05c0a90d28c968a1cad4fb31abd0b8e1264e788ccefed022ae1d3b6f627514.js integrity="sha256-DAXAqQ0oyWihytT7MavQuOEmTniMzv7QIq4dO29idRQ=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker Pulling Pushing Batch Shell Script"><meta name=twitter:description content="从源镜像仓库批量拉取镜像，并将这些镜像推送到目标镜像仓库的批量脚本
#!/bin/bash  ################################################# # 使用方式 # 从源仓库拉取镜像到本机 # sh docker-images-pulling-pushing.sh pull # # 将本机镜像推送到目的仓库 # sh docker-images-pulling-pushing.sh push # # 清理本机的镜像 # sh docker-images-pulling-pushing.sh clean ################################################# # 源仓库地址 DOCKER_REPO_FROM= # 目标仓库地址 DOCKER_REPO_TO=192.168.2.2:8888/ DOCKER_REPO_TO_USER=test DOCKER_REPO_TO_PASS=Test123456 # 镜像定义 DOCKER_IMAGES=() DOCKER_IMAGES+=(postgres:9.6) DOCKER_IMAGES+=(elasticsearch:6.6.2) DOCKER_IMAGES+=(coolbeevip/servicecomb-pack) # 从源仓库地址拉取镜像到本机仓库 function pull(){ echo &#34;Pull images from $DOCKER_REPO_FROM&#34; for image in ${DOCKER_IMAGES[@]}; do docker pull $DOCKER_REPO_FROM$image done } # 本机镜像推送到目的仓库 function push(){ docker login http://$DOCKER_REPO_TO -u $DOCKER_REPO_TO_USER -p $DOCKER_REPO_TO_PASS echo &#34;Push $DOCKER_REPO_FROMto $DOCKER_REPO_TO&#34; for image in ${DOCKER_IMAGES[@]}; do docker image tag $DOCKER_REPO_FROM$image $DOCKER_REPO_TO$image docker push $DOCKER_REPO_TO$image done } # 清理本机拉取后的镜像 function clean(){ echo &#34;Remove images&#34; docker rmi -f $(docker images | grep $DOCKER_REPO_FROM | awk '{print $3}') docker rmi -f $(docker images | grep $DOCKER_REPO_TO | awk '{print $3}') } case &#34;${@: -1}&#34; in pull ) pull ;; clean ) clean ;; push ) push ;; esac "></head><body><div class="sidebar animated fadeInDown"><div class=logo-title><div class=title><img src=/images/profile.jpg alt="profile picture"><h3 title><a href=/>I'm Lei Zhang</a></h3><div class=description><p>This is my knowledge base. I document things here</p></div></div></div><ul class=social-links><li><a href=https://github.com/coolbeevip/ rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:zhanglei@apache.org rel=me aria-label=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Lei Zhang 2021</div></div></div><div class=main><div class="page-top animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a href=/ title>Home</a></li><li><a href=/bookmarks title>Bookmarks</a></li><li><a href=/about/ title>About</a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post animated fadeInDown"><div class=post-content><div class=post-title><h3>Docker Pulling Pushing Batch Shell Script</h3></div><p>从源镜像仓库批量拉取镜像，并将这些镜像推送到目标镜像仓库的批量脚本</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
<span style=color:#75715e>#################################################</span>
<span style=color:#75715e># 使用方式</span>
<span style=color:#75715e>#  从源仓库拉取镜像到本机</span>
<span style=color:#75715e>#  sh docker-images-pulling-pushing.sh pull</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e>#  将本机镜像推送到目的仓库</span>
<span style=color:#75715e>#  sh docker-images-pulling-pushing.sh push</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e>#  清理本机的镜像</span>
<span style=color:#75715e>#  sh docker-images-pulling-pushing.sh clean</span>
<span style=color:#75715e>#################################################</span>

<span style=color:#75715e># 源仓库地址</span>
DOCKER_REPO_FROM<span style=color:#f92672>=</span>
<span style=color:#75715e># 目标仓库地址</span>
DOCKER_REPO_TO<span style=color:#f92672>=</span>192.168.2.2:8888/
DOCKER_REPO_TO_USER<span style=color:#f92672>=</span>test
DOCKER_REPO_TO_PASS<span style=color:#f92672>=</span>Test123456

<span style=color:#75715e># 镜像定义</span>
DOCKER_IMAGES<span style=color:#f92672>=()</span>
DOCKER_IMAGES<span style=color:#f92672>+=(</span>postgres:9.6<span style=color:#f92672>)</span>
DOCKER_IMAGES<span style=color:#f92672>+=(</span>elasticsearch:6.6.2<span style=color:#f92672>)</span>
DOCKER_IMAGES<span style=color:#f92672>+=(</span>coolbeevip/servicecomb-pack<span style=color:#f92672>)</span>

<span style=color:#75715e># 从源仓库地址拉取镜像到本机仓库</span>
<span style=color:#66d9ef>function</span> pull<span style=color:#f92672>(){</span>
  echo <span style=color:#e6db74>&#34;Pull images from </span>$DOCKER_REPO_FROM<span style=color:#e6db74>&#34;</span>
  <span style=color:#66d9ef>for</span> image in <span style=color:#e6db74>${</span>DOCKER_IMAGES[@]<span style=color:#e6db74>}</span>;
  <span style=color:#66d9ef>do</span>
    docker pull $DOCKER_REPO_FROM$image
  <span style=color:#66d9ef>done</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e># 本机镜像推送到目的仓库</span>
<span style=color:#66d9ef>function</span> push<span style=color:#f92672>(){</span>
  docker login http://$DOCKER_REPO_TO -u $DOCKER_REPO_TO_USER -p $DOCKER_REPO_TO_PASS
  echo <span style=color:#e6db74>&#34;Push </span>$DOCKER_REPO_FROM<span style=color:#e6db74> to </span>$DOCKER_REPO_TO<span style=color:#e6db74>&#34;</span>
  <span style=color:#66d9ef>for</span> image in <span style=color:#e6db74>${</span>DOCKER_IMAGES[@]<span style=color:#e6db74>}</span>;
  <span style=color:#66d9ef>do</span>
    docker image tag $DOCKER_REPO_FROM$image $DOCKER_REPO_TO$image
    docker push $DOCKER_REPO_TO$image
  <span style=color:#66d9ef>done</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e># 清理本机拉取后的镜像</span>
<span style=color:#66d9ef>function</span> clean<span style=color:#f92672>(){</span>
  echo <span style=color:#e6db74>&#34;Remove images&#34;</span>
  docker rmi -f <span style=color:#66d9ef>$(</span>docker images | grep $DOCKER_REPO_FROM | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span><span style=color:#66d9ef>)</span>
  docker rmi -f <span style=color:#66d9ef>$(</span>docker images | grep $DOCKER_REPO_TO | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span><span style=color:#66d9ef>)</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>@: -1<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> in
	pull <span style=color:#f92672>)</span>
		pull
		;;
  clean <span style=color:#f92672>)</span>
		clean
		;;
	push <span style=color:#f92672>)</span>
		push
		;;
<span style=color:#66d9ef>esac</span>
</code></pre></div></div><div class=post-footer><div class=info><span class=separator><a class=category href=/categories/docker/>docker</a><a class=category href=/categories/shell/>shell</a></span></div></div></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.2d6fd0be87fa98f0c9b4dc2536b312bbca48757f584f6ea1f394abc9bcc38fbc.js integrity="sha256-LW/Qvof6mPDJtNwlNrMSu8pIdX9YT26h85SrybzDj7w=" crossorigin=anonymous></script></body></html>