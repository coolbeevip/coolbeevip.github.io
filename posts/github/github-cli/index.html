<!doctype html><html lang=en data-theme><head><title>Lei Zhang | Batch Deleting GitHub Actions Records with a Bash Script </title><meta charset=utf-8><meta name=generator content="Hugo 0.123.3"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="This is my knowledge base. I document things here"><link rel=stylesheet href=/css/style.min.7cf3c5090ac13256a5fa5531e5649cfe5a2ba7de88dca14ce0b6e253409a3511.css integrity="sha256-fPPFCQrBMlal+lUx5WSc/lorp96I3KFM4LbiU0CaNRE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.d03676fac5605f1e95639c8b2239ea77daf8804fe13da2208bb83b252959846c.css integrity="sha256-0DZ2+sVgXx6VY5yLIjnqd9r4gE/hPaIgi7g7JSlZhGw=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=/posts/github/github-cli/><script type=text/javascript src=/js/anatole-header.min.df804b63b5bd8474ea0756ea874bc8f1e92552708cc6ea43aa0d76981dc419f9.js integrity="sha256-34BLY7W9hHTqB1bqh0vI8eklUnCMxupDqg12mB3EGfk=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Batch Deleting GitHub Actions Records with a Bash Script"><meta name=twitter:description content="As automation becomes an integral part of the development process, GitHub Actions has become an essential component for managing CI/CD workflows in many projects. However, over time, you might accumulate a large number of workflow run records, which can not only take up storage space but also potentially impact performance. In such cases, periodically cleaning up these records becomes crucial. Today, we&rsquo;ll demonstrate how to batch delete GitHub Actions records using a simple Bash script."></head><body><div class="sidebar ."><div class=logo-title><div class=title><img src=/images/profile.jpg alt="profile picture"><h3 title><a href=/>I'm Lei Zhang</a></h3><div class=description><p>This is my knowledge base. I document things here</p></div></div><p><a href=https://github.com/coolbeevip><img src="https://img.shields.io/github/followers/coolbeevip?label=follow&amp;style=social" alt="GitHub coolbeevip"></a>
<img src=https://badges.pufler.dev/commits/all/coolbeevip alt="Commits Badge">
<img src=https://badges.pufler.dev/repos/coolbeevip alt="Repos Badge">
<img src=https://badges.pufler.dev/years/coolbeevip alt="Years Badge"></p></div><ul class=social-links><li><a href=https://github.com/coolbeevip/ rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:zhanglei@apache.org rel=me aria-label=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Lei Zhang 2024</div></div></div><div class=main><div class="page-top ."><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a href=/ title>Home</a></li><li><a href=/posts title>Blog</a></li><li><a href=/bookmarks title>Bookmarks</a></li><li><a href=/about/ title>About</a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post ."><div class=post-content><div class=post-title><h3>Batch Deleting GitHub Actions Records with a Bash Script</h3></div><p>As automation becomes an integral part of the development process, GitHub Actions has become an essential component for managing CI/CD workflows in many projects. However, over time, you might accumulate a large number of workflow run records, which can not only take up storage space but also potentially impact performance. In such cases, periodically cleaning up these records becomes crucial. Today, we&rsquo;ll demonstrate how to batch delete GitHub Actions records using a simple Bash script.</p><h2 id=prerequisites>Prerequisites</h2><p>Before we begin, ensure that you meet the following requirements:</p><ol><li><strong>Install <code>gh</code> CLI</strong>: Make sure you have the GitHub Command Line Interface (<code>gh</code>) installed. You can find installation instructions on the <a href=https://cli.github.com/>GitHub CLI website</a>.</li><li><strong>Install <code>jq</code></strong>: This tool is used for processing JSON data. You can install it using the following commands:<ul><li>On macOS: <code>brew install jq</code></li><li>On Ubuntu: <code>sudo apt-get install jq</code></li></ul></li><li><strong>Generate a GitHub Personal Access Token</strong>: You&rsquo;ll need a GitHub Personal Access Token with the appropriate permissions. Visit the <a href=https://github.com/settings/tokens>GitHub Settings</a> page to generate one, ensuring that you select the <code>repo</code> scope.</li><li><strong>Set the Environment Variable</strong>: To keep things secure, we will store the access token in the environment variable <code>GPA_TOKEN</code>.</li></ol><h2 id=script-implementation>Script Implementation</h2><p>Here&rsquo;s our example Bash script, named <code>delete_github_actions.sh</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exit immediately if a command exits with a non-zero status</span>
</span></span><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Read Github personal access tokens from environment variable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -z <span style=color:#e6db74>&#34;</span>$GPA_TOKEN<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Error: GPA_TOKEN environment variable is not set.&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set the repository information</span>
</span></span><span style=display:flex><span>REPO<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;your_github_username/your_repository_name&#34;</span>  <span style=color:#75715e># Replace with your repository information</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Fetch the databaseId list</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Fetching GitHub Actions run IDs...&#34;</span>
</span></span><span style=display:flex><span>RUN_IDS<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>gh run list --limit <span style=color:#ae81ff>100</span> --json databaseId | jq -r <span style=color:#e6db74>&#39;.[].databaseId&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check if there are any runs to delete</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -z <span style=color:#e6db74>&#34;</span>$RUN_IDS<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;No GitHub Actions runs found.&#34;</span>
</span></span><span style=display:flex><span>    exit <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Loop through and delete each run</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;</span>$RUN_IDS<span style=color:#e6db74>&#34;</span> | <span style=color:#66d9ef>while</span> read -r RUN_ID; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Deleting run ID: </span>$RUN_ID<span style=color:#e6db74>...&#34;</span>
</span></span><span style=display:flex><span>    curl -X DELETE -H <span style=color:#e6db74>&#34;Authorization: token </span>$GPA_TOKEN<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>         <span style=color:#e6db74>&#34;https://api.github.com/repos/</span>$REPO<span style=color:#e6db74>/actions/runs/</span>$RUN_ID<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>         -s
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $? -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Successfully deleted run ID: </span>$RUN_ID<span style=color:#e6db74>.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Failed to delete run ID: </span>$RUN_ID<span style=color:#e6db74>.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;All specified GitHub Actions runs have been processed.&#34;</span>
</span></span></code></pre></div><h3 id=how-to-execute-the-script>How to Execute the Script</h3><ol><li>Copy the script code into a text editor and save it as <code>delete_github_actions.sh</code>.</li><li>Make the script executable with the following command:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x delete_github_actions.sh
</span></span></code></pre></div></li><li>Set the <code>$GPA_TOKEN</code> environment variable in your terminal:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export GPA_TOKEN<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;your_personal_access_token&#34;</span>
</span></span></code></pre></div></li><li>Run the script:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./delete_github_actions.sh
</span></span></code></pre></div></li></ol><h2 id=conclusion>Conclusion</h2><p>With this script, you can easily batch delete unnecessary GitHub Actions records. However, please be cautiousâ€”this operation is irreversible! Regularly cleaning up workflow run records will help maintain a tidy and efficient GitHub repository.</p><p>I hope you find this script helpful! If you have any questions or need further assistance, feel free to reach out.</p></div><div class=post-footer><div class=info><span class=separator><a class=category href=/categories/gh/>gh</a><a class=category href=/categories/actions/>actions</a></span>
<span class=separator><a class=tag href=/tags/github/>github</a></span></div></div></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.e1c6918cbaa90022a5612f0bd71c7bf3be6d036614c5729cebfe14f7b91fa4bc.js integrity="sha256-4caRjLqpACKlYS8L1xx7875tA2YUxXKc6/4U97kfpLw=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css integrity=sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js integrity=sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js integrity=sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v crossorigin=anonymous onload=renderMathInElement(document.body)></script></body></html>