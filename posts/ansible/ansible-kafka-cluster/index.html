<!doctype html><html lang=en data-theme><head><title>Lei Zhang | Automate Install Kafka Cluster with Ansible Playbook</title><meta charset=utf-8><meta name=generator content="Hugo 0.113.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="This is my knowledge base. I document things here"><link rel=stylesheet href=/css/style.min.7cf3c5090ac13256a5fa5531e5649cfe5a2ba7de88dca14ce0b6e253409a3511.css integrity="sha256-fPPFCQrBMlal+lUx5WSc/lorp96I3KFM4LbiU0CaNRE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.3fa691134fafa8351e9d193939a352647c1ae886828bdefa3f5a272653dbf7e4.css integrity="sha256-P6aRE0+vqDUenRk5OaNSZHwa6IaCi976P1onJlPb9+Q=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=/posts/ansible/ansible-kafka-cluster/><script type=text/javascript src=/js/anatole-header.min.df804b63b5bd8474ea0756ea874bc8f1e92552708cc6ea43aa0d76981dc419f9.js integrity="sha256-34BLY7W9hHTqB1bqh0vI8eklUnCMxupDqg12mB3EGfk=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Automate Install Kafka Cluster with Ansible Playbook"><meta name=twitter:description content="集群概述 此脚本中的配置基于 Kafka 2.6.3 版本 使用 Kafka 发布包中自带的 Zookeeper 组件（通常这没有问题，除非你要将 Zookeeper 安装在单独的服务器上） 在 Kafka 安装目录下独立安装 JDK，目前只支持 Java 8 和 Java 11。 安装计划 服务器规划
IP SSH 端口 SSH 用户 SSH 密码 ROOT 密码 OS 10.1.207.177 22022 kafka 123456 root123 CentOS Linux release 7.9.2009 10.1.207.178 22022 kafka 123456 root123 CentOS Linux release 7.9.2009 10.1.207.183 22022 kafka 123456 root123 CentOS Linux release 7.9.2009 提示： 可以参考批量自动化创建用户
集群节点规划
IP地址 Kafka Zookeeper Java 10.1.207.177 ✓ ✓ ✓ 10."></head><body><div class="sidebar ."><div class=logo-title><div class=title><img src=/images/profile.jpg alt="profile picture"><h3 title><a href=/>I'm Lei Zhang</a></h3><div class=description><p>This is my knowledge base. I document things here</p></div></div><p><a href=https://github.com/coolbeevip><img src="https://img.shields.io/github/followers/coolbeevip?label=follow&amp;style=social" alt="GitHub coolbeevip"></a>
<img src=https://badges.pufler.dev/commits/all/coolbeevip alt="Commits Badge">
<img src=https://badges.pufler.dev/repos/coolbeevip alt="Repos Badge">
<img src=https://badges.pufler.dev/years/coolbeevip alt="Years Badge"></p></div><ul class=social-links><li><a href=https://github.com/coolbeevip/ rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:zhanglei@apache.org rel=me aria-label=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Lei Zhang 2023</div></div></div><div class=main><div class="page-top ."><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a href=/ title>Home</a></li><li><a href=/posts title>Blog</a></li><li><a href=/bookmarks title>Bookmarks</a></li><li><a href=/about/ title>About</a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post ."><div class=post-content><div class=post-title><h3>Automate Install Kafka Cluster with Ansible Playbook</h3></div><h2 id=集群概述>集群概述</h2><ul><li>此脚本中的配置基于 Kafka 2.6.3 版本</li><li>使用 Kafka 发布包中自带的 Zookeeper 组件（通常这没有问题，除非你要将 Zookeeper 安装在单独的服务器上）</li><li>在 Kafka 安装目录下独立安装 JDK，目前只支持 Java 8 和 Java 11。</li></ul><h2 id=安装计划>安装计划</h2><p>服务器规划</p><table><thead><tr><th>IP</th><th>SSH 端口</th><th>SSH 用户</th><th>SSH 密码</th><th>ROOT 密码</th><th>OS</th></tr></thead><tbody><tr><td>10.1.207.177</td><td>22022</td><td>kafka</td><td>123456</td><td>root123</td><td>CentOS Linux release 7.9.2009</td></tr><tr><td>10.1.207.178</td><td>22022</td><td>kafka</td><td>123456</td><td>root123</td><td>CentOS Linux release 7.9.2009</td></tr><tr><td>10.1.207.183</td><td>22022</td><td>kafka</td><td>123456</td><td>root123</td><td>CentOS Linux release 7.9.2009</td></tr></tbody></table><p><strong>提示：</strong> 可以参考<a href=https://github.com/coolbeevip/ansible-playbook/blob/main/README_ZH.md#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84>批量自动化创建用户</a></p><p>集群节点规划</p><table><thead><tr><th>IP地址</th><th>Kafka</th><th>Zookeeper</th><th>Java</th></tr></thead><tbody><tr><td>10.1.207.177</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>10.1.207.178</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>10.1.207.183</td><td>✓</td><td>✓</td><td>✓</td></tr></tbody></table><p>节点安装路径</p><table><thead><tr><th>路径</th><th>描述</th></tr></thead><tbody><tr><td>/opt/kafka</td><td>Kafka, Zookeeper, Java 软件安装路径</td></tr><tr><td>~/zookeeper.sh</td><td>Zookeeper 启动，停止，状态命令脚本</td></tr><tr><td>~/kafka.sh</td><td>Kafka 启动，停止，状态命令脚本</td></tr><tr><td>~/kafka_uninstall.sh</td><td>Kafka 集群卸载脚本</td></tr><tr><td>/data01/kafka/kafka_data</td><td>Kafka 数据目录</td></tr><tr><td>/data01/kafka/kafka_log</td><td>Kafka 日志目录</td></tr><tr><td>/data01/kafka/zookeeper_data</td><td>Zookeeper 数据目录</td></tr><tr><td>/data01/kafka/zookeeper_log</td><td>Zookeeper 日志目录</td></tr></tbody></table><h2 id=下载安装包和-playbook-脚本>下载安装包和 Playbook 脚本</h2><p>在客户机上创建 playbook 脚本存放目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p ~/my-docker-volume/ansible-playbook
</span></span></code></pre></div><p>下载 playbook 脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd ~/my-docker-volume/ansible-playbook
</span></span><span style=display:flex><span>git clone https://github.com/coolbeevip/ansible-playbook.git
</span></span></code></pre></div><p>从 <a href=https://kafka.apache.org/downloads>https://kafka.apache.org/downloads</a> 下载 Kafka 安装包到 <code>~/my-docker-volume/ansible-playbook/packages</code> 目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget -P ~/my-docker-volume/ansible-playbook/packages https://dlcdn.apache.org/kafka/2.6.3/kafka_2.12-2.6.3.tgz --no-check-certificate
</span></span></code></pre></div><p>下载 JDK 安装包 <code>jdk-8u202-linux-x64.tar.gz</code> 到 <code>~/my-docker-volume/ansible-playbook/packages</code> 目录</p><h2 id=配置安装脚本>配置安装脚本</h2><blockquote><p>您可以编辑以下配置文件，修改默认参数</p></blockquote><h4 id=mainyml>main.yml</h4><p>安装 Kafka 集群的服务器 IP 地址，以及系统用户名</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>10.1.207.177</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>user</span>: <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>10.1.207.178</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>user</span>: <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>10.1.207.183</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>user</span>: <span style=color:#ae81ff>kafka</span>
</span></span></code></pre></div><h3 id=vars_kafkayml>vars_kafka.yml</h3><p>操作系统 Limits</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Linux limits</span>
</span></span><span style=display:flex><span><span style=color:#f92672>limits_hard_nproc</span>: <span style=color:#e6db74>&#39;65535&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>limits_soft_nproc</span>: <span style=color:#e6db74>&#39;65535&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>limits_hard_nofile</span>: <span style=color:#e6db74>&#39;65535&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>limits_soft_nofile</span>: <span style=color:#e6db74>&#39;65535&#39;</span>
</span></span></code></pre></div><p>安装用的用户名、用户组</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Linux user &amp; group</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_user</span>: <span style=color:#e6db74>&#34;kafka&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_group</span>: <span style=color:#e6db74>&#34;kafka&#34;</span>
</span></span></code></pre></div><p>安装介质名称以及解压后的目录名</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Kafka package</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_tar</span>: <span style=color:#e6db74>&#34;kafka_2.12-2.6.3.tgz&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_tar_unzip_dir</span>: <span style=color:#e6db74>&#34;kafka_2.12-2.6.3&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Java package</span>
</span></span><span style=display:flex><span><span style=color:#f92672>java_tar</span>: <span style=color:#e6db74>&#34;jdk-8u202-linux-x64.tar.gz&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>java_tar_unzip_dir</span>: <span style=color:#e6db74>&#34;jdk-8u202-linux-x64&#34;</span>
</span></span></code></pre></div><p>安装目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kafka_home_dir</span>: <span style=color:#e6db74>&#34;/opt/kafka&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_data_dir</span>: <span style=color:#e6db74>&#34;/data01/kafka/kafka_data&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_log_dir</span>: <span style=color:#e6db74>&#34;/data01/kafka/kafka_log&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>zookeeper_data_dir</span>: <span style=color:#e6db74>&#34;/data01/kafka/zookeeper_data&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>zookeeper_log_dir</span>: <span style=color:#e6db74>&#34;/data01/kafka/zookeeper_log&#34;</span>
</span></span></code></pre></div><p>kafka & Zookeeper 在每个服务器上的 ID</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Node configuration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>10.1.207.177</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>zookeeper_id</span>: <span style=color:#ae81ff>177</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kafka_broker_id</span>: <span style=color:#ae81ff>177</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>10.1.207.178</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>zookeeper_id</span>: <span style=color:#ae81ff>178</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kafka_broker_id</span>: <span style=color:#ae81ff>178</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>10.1.207.183</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>zookeeper_id</span>: <span style=color:#ae81ff>183</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kafka_broker_id</span>: <span style=color:#ae81ff>183</span>
</span></span></code></pre></div><p>Zookeeper 服务配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>zookeeper_client_port</span>: <span style=color:#ae81ff>2181</span> <span style=color:#75715e># the port at which the clients will connect</span>
</span></span><span style=display:flex><span><span style=color:#f92672>zookeeper_follower_port</span>: <span style=color:#ae81ff>2888</span> <span style=color:#75715e># the port for follower connections</span>
</span></span><span style=display:flex><span><span style=color:#f92672>zookeeper_election_port</span>: <span style=color:#ae81ff>3888</span> <span style=color:#75715e># the port for other server connections during the leader election phase</span>
</span></span><span style=display:flex><span><span style=color:#f92672>zookeeper_max_client_cnxns</span>: <span style=color:#ae81ff>0</span> <span style=color:#75715e># setting number of connections to unlimited</span>
</span></span><span style=display:flex><span><span style=color:#f92672>zookeeper_tick_time</span>: <span style=color:#ae81ff>2000</span> <span style=color:#75715e># keeps a heartbeat of zookeeper in milliseconds</span>
</span></span><span style=display:flex><span><span style=color:#f92672>zookeeper_init_limit</span>: <span style=color:#ae81ff>10</span>  <span style=color:#75715e># time for initial synchronization</span>
</span></span><span style=display:flex><span><span style=color:#f92672>zookeeper_sync_limit</span>: <span style=color:#ae81ff>5</span>   <span style=color:#75715e># how many ticks can pass before timeout</span>
</span></span></code></pre></div><p>Kafka 服务配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kafka_server_port</span>: <span style=color:#ae81ff>9003</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_server_num_partitions</span>: <span style=color:#ae81ff>8</span> <span style=color:#75715e># default number of partitions</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_server_offsets_topic_replication_factor</span>: <span style=color:#ae81ff>3</span> <span style=color:#75715e># The replication factor for the group metadata internal topics &#34;__consumer_offsets&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_server_transaction_state_log_replication_factor</span>: <span style=color:#ae81ff>3</span> <span style=color:#75715e># The replication factor for the group metadata internal topics &#34;__transaction_state&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_server_transaction_state_log_min_isr</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_server_default_replication_factor</span>: <span style=color:#ae81ff>3</span> <span style=color:#75715e># default replica count based on the number of brokers</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_server_min_insync_replicas</span>: <span style=color:#ae81ff>2</span> <span style=color:#75715e># to protect yourself against broker failure</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kafka_server_zookeeper_connection_timeout_ms</span>: <span style=color:#ae81ff>6000</span> <span style=color:#75715e># timeout for connecting with zookeeper</span>
</span></span></code></pre></div><p>更多Kafka 配置参见<a href=https://kafka.apache.org/26/documentation.html>2.6.X</a></p><h2 id=开始安装>开始安装</h2><p>启动 ansible 容器工具连接目标服务器，并将 <code>~/my-docker-volume/ansible-playbook</code> 目录挂载到容器中。</p><p>提示： ANSIBLE_SSH_USERS，ANSIBLE_SSH_PASSS 配置成您之前在目标服务器上创建的用户名 kafka 和密码 123456</p><p>提示： ANSIBLE_SU_PASSS 为 root 用户的密码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --name ansible --rm -it <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e ANSIBLE_SSH_HOSTS<span style=color:#f92672>=</span>10.1.207.177,10.1.207.178,10.1.207.183 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e ANSIBLE_SSH_PORTS<span style=color:#f92672>=</span>22022,22022,22022 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e ANSIBLE_SSH_USERS<span style=color:#f92672>=</span>kafka,kafka,kafka <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e ANSIBLE_SSH_PASSS<span style=color:#f92672>=</span>123456,123456,123456 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e ANSIBLE_SU_PASSS<span style=color:#f92672>=</span>root123,root123,root123 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /Users/zhanglei/mydocker/volume/ansible-playbook:/ansible-playbook <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  coolbeevip/ansible:2.8.11-alpine <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  /bin/bash  
</span></span></code></pre></div><h4 id=安装-kafka-集群>安装 Kafka 集群</h4><p>这个脚本将自动化完成如下操作：</p><ul><li>在每个服务器上配置系统参数 & 创建安装目录</li><li>上传 Kafka & JDK 安装介质上传到每个服务器</li><li>配置每个服务器上的 server.properties 和 zookeeper.properties</li><li>启动 Zookeeper & Kafka 服务</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible-playbook -C /ansible-playbook/kafka/main.yml
</span></span></code></pre></div><p><strong>提示:</strong> 因为第一次执行脚本时，会上传 Kafka 和 JDK 安装包到所有服务器（约 260MB），所以执行时间较长（取决于你的客户端和服务器之间的网络速度）。 你也可以在执行以上脚本前手动将安装包上传到服务器的安装路径 /opt/kafka 下。在我本地环境首次安装大概耗时 6 分钟（上传安装包大概 1 分钟，安装集群大概 5 分钟）</p><p><strong>提示:</strong> 此脚本只适合初始化安装，重复执行此命令可能会收到 Kafka has been installed, please uninstall and then reinstall 提示，此时需要先要使用 ansible all -m shell -a &lsquo;~/kafka_uninstall.sh&rsquo; 命令卸载之前的安装。</p><p>如果你看到如下信息，说明安装完成</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>TASK <span style=color:#f92672>[</span>Install Succeed<span style=color:#f92672>]</span> ********************************************************************************************************************************************************************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>10.1.207.183<span style=color:#f92672>]</span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;msg&#34;</span>: <span style=color:#e6db74>&#34;Install Succeed!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=验证-kafka-集群>验证 Kafka 集群</h4><p>查看 Zookeeper PID</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;~/zookeeper.sh status&#39;</span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Zookeeper is Running as PID: <span style=color:#ae81ff>9477</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Zookeeper is Running as PID: <span style=color:#ae81ff>31545</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Zookeeper is Running as PID: <span style=color:#ae81ff>23435</span>
</span></span></code></pre></div><p>查看 Kafka PID</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;~/kafka.sh status&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Kafka is Running as PID: <span style=color:#ae81ff>7569</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Kafka is Running as PID: <span style=color:#ae81ff>15901</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Kafka is Running as PID: <span style=color:#ae81ff>26639</span>
</span></span></code></pre></div><p>检测 Zookeeper 成功时返回 <strong>imok</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;echo ruok | nc {{ inventory_hostname }} 2181; echo&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>imok
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>imok
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>imok
</span></span></code></pre></div><p>在任一 Kafka 节点上执行基准测试命令 <code>benchmark-test.sh</code>。发送和接收 500 万条消息，每条消息 1KB，最终显示发送者和消费者的吞吐率信息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>kafka@oss-irms-177 bin<span style=color:#f92672>]</span>$ ~/benchmark-test.sh
</span></span><span style=display:flex><span>STEP1/4: Create topic benchmark-topic
</span></span><span style=display:flex><span>Created topic benchmark-topic.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>STEP2/4: Producer performance test
</span></span><span style=display:flex><span><span style=color:#ae81ff>41825</span> records sent, 8363.3 records/sec <span style=color:#f92672>(</span>7.98 MB/sec<span style=color:#f92672>)</span>, 1178.2 ms avg latency, 2461.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>50000</span> records sent, 8488.964346 records/sec <span style=color:#f92672>(</span>8.10 MB/sec<span style=color:#f92672>)</span>, 1291.81 ms avg latency, 2461.00 ms max latency, <span style=color:#ae81ff>1165</span> ms 50th, <span style=color:#ae81ff>2115</span> ms 95th, <span style=color:#ae81ff>2325</span> ms 99th, <span style=color:#ae81ff>2460</span> ms 99.9th.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>STEP3/4: Consumer performance test
</span></span><span style=display:flex><span>start.time, end.time, data.consumed.in.MB, MB.sec, data.consumed.in.nMsg, nMsg.sec, rebalance.time.ms, fetch.time.ms, fetch.MB.sec, fetch.nMsg.sec
</span></span><span style=display:flex><span>2021-12-09 16:05:17:113, 2021-12-09 16:05:21:696, 47.6837, 10.4045, 50000, 10909.8844, 1639037119044, -1639037114461, -0.0000, -0.0000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>STEP4/4: Delete topic benchmark-topic
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>kafka@oss-irms-177 bin<span style=color:#f92672>]</span>$ vi ~/benchmark-test.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>kafka@oss-irms-177 bin<span style=color:#f92672>]</span>$ ~/benchmark-test.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>STEP1/4: Create topic benchmark-topic
</span></span><span style=display:flex><span>Created topic benchmark-topic.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>STEP2/4: Producer performance test
</span></span><span style=display:flex><span><span style=color:#ae81ff>154401</span> records sent, 30874.0 records/sec <span style=color:#f92672>(</span>29.44 MB/sec<span style=color:#f92672>)</span>, 621.5 ms avg latency, 1805.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>80224</span> records sent, 16041.6 records/sec <span style=color:#f92672>(</span>15.30 MB/sec<span style=color:#f92672>)</span>, 2028.6 ms avg latency, 3677.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>209827</span> records sent, 41957.0 records/sec <span style=color:#f92672>(</span>40.01 MB/sec<span style=color:#f92672>)</span>, 906.9 ms avg latency, 3408.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>125145</span> records sent, 25029.0 records/sec <span style=color:#f92672>(</span>23.87 MB/sec<span style=color:#f92672>)</span>, 845.3 ms avg latency, 4060.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>128368</span> records sent, 25658.2 records/sec <span style=color:#f92672>(</span>24.47 MB/sec<span style=color:#f92672>)</span>, 1480.5 ms avg latency, 4892.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>63145</span> records sent, 12496.5 records/sec <span style=color:#f92672>(</span>11.92 MB/sec<span style=color:#f92672>)</span>, 2219.6 ms avg latency, 5571.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>104873</span> records sent, 18930.1 records/sec <span style=color:#f92672>(</span>18.05 MB/sec<span style=color:#f92672>)</span>, 1434.3 ms avg latency, 6640.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>109572</span> records sent, 21910.0 records/sec <span style=color:#f92672>(</span>20.90 MB/sec<span style=color:#f92672>)</span>, 1982.4 ms avg latency, 5869.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>131271</span> records sent, 25739.4 records/sec <span style=color:#f92672>(</span>24.55 MB/sec<span style=color:#f92672>)</span>, 831.3 ms avg latency, 4349.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>136261</span> records sent, 27246.8 records/sec <span style=color:#f92672>(</span>25.98 MB/sec<span style=color:#f92672>)</span>, 1584.6 ms avg latency, 5031.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>85629</span> records sent, 16803.2 records/sec <span style=color:#f92672>(</span>16.02 MB/sec<span style=color:#f92672>)</span>, 1628.3 ms avg latency, 5089.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>73866</span> records sent, 14612.5 records/sec <span style=color:#f92672>(</span>13.94 MB/sec<span style=color:#f92672>)</span>, 1716.6 ms avg latency, 6803.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>105543</span> records sent, 21100.2 records/sec <span style=color:#f92672>(</span>20.12 MB/sec<span style=color:#f92672>)</span>, 2119.1 ms avg latency, 7117.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>77355</span> records sent, 15471.0 records/sec <span style=color:#f92672>(</span>14.75 MB/sec<span style=color:#f92672>)</span>, 1912.0 ms avg latency, 5498.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>101397</span> records sent, 19846.7 records/sec <span style=color:#f92672>(</span>18.93 MB/sec<span style=color:#f92672>)</span>, 1793.0 ms avg latency, 6986.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>200199</span> records sent, 40031.8 records/sec <span style=color:#f92672>(</span>38.18 MB/sec<span style=color:#f92672>)</span>, 1042.1 ms avg latency, 4969.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>97188</span> records sent, 18189.8 records/sec <span style=color:#f92672>(</span>17.35 MB/sec<span style=color:#f92672>)</span>, 1126.6 ms avg latency, 4933.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>185294</span> records sent, 37058.8 records/sec <span style=color:#f92672>(</span>35.34 MB/sec<span style=color:#f92672>)</span>, 1307.4 ms avg latency, 6376.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>249676</span> records sent, 49925.2 records/sec <span style=color:#f92672>(</span>47.61 MB/sec<span style=color:#f92672>)</span>, 659.5 ms avg latency, 2987.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>385945</span> records sent, 77189.0 records/sec <span style=color:#f92672>(</span>73.61 MB/sec<span style=color:#f92672>)</span>, 425.9 ms avg latency, 1282.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>205702</span> records sent, 41132.2 records/sec <span style=color:#f92672>(</span>39.23 MB/sec<span style=color:#f92672>)</span>, 792.5 ms avg latency, 3450.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>174103</span> records sent, 34820.6 records/sec <span style=color:#f92672>(</span>33.21 MB/sec<span style=color:#f92672>)</span>, 837.0 ms avg latency, 2014.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>95234</span> records sent, 19043.0 records/sec <span style=color:#f92672>(</span>18.16 MB/sec<span style=color:#f92672>)</span>, 1596.3 ms avg latency, 4084.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>82637</span> records sent, 16524.1 records/sec <span style=color:#f92672>(</span>15.76 MB/sec<span style=color:#f92672>)</span>, 1595.8 ms avg latency, 4584.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>127413</span> records sent, 25477.5 records/sec <span style=color:#f92672>(</span>24.30 MB/sec<span style=color:#f92672>)</span>, 1753.8 ms avg latency, 4631.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>175331</span> records sent, 35066.2 records/sec <span style=color:#f92672>(</span>33.44 MB/sec<span style=color:#f92672>)</span>, 998.8 ms avg latency, 3002.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>412244</span> records sent, 82448.8 records/sec <span style=color:#f92672>(</span>78.63 MB/sec<span style=color:#f92672>)</span>, 382.2 ms avg latency, 1177.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>150998</span> records sent, 30139.3 records/sec <span style=color:#f92672>(</span>28.74 MB/sec<span style=color:#f92672>)</span>, 986.8 ms avg latency, 3473.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>85045</span> records sent, 16737.8 records/sec <span style=color:#f92672>(</span>15.96 MB/sec<span style=color:#f92672>)</span>, 1717.5 ms avg latency, 4346.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>81438</span> records sent, 15095.1 records/sec <span style=color:#f92672>(</span>14.40 MB/sec<span style=color:#f92672>)</span>, 1898.2 ms avg latency, 5302.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>121741</span> records sent, 24348.2 records/sec <span style=color:#f92672>(</span>23.22 MB/sec<span style=color:#f92672>)</span>, 1556.8 ms avg latency, 6129.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>117458</span> records sent, 23421.3 records/sec <span style=color:#f92672>(</span>22.34 MB/sec<span style=color:#f92672>)</span>, 1278.0 ms avg latency, 3955.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>116391</span> records sent, 23273.5 records/sec <span style=color:#f92672>(</span>22.20 MB/sec<span style=color:#f92672>)</span>, 1509.0 ms avg latency, 3597.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>88623</span> records sent, 17714.0 records/sec <span style=color:#f92672>(</span>16.89 MB/sec<span style=color:#f92672>)</span>, 2034.1 ms avg latency, 4512.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>106804</span> records sent, 20946.1 records/sec <span style=color:#f92672>(</span>19.98 MB/sec<span style=color:#f92672>)</span>, 1494.2 ms avg latency, 3443.0 ms max latency.
</span></span><span style=display:flex><span><span style=color:#ae81ff>5000000</span> records sent, 27473.131278 records/sec <span style=color:#f92672>(</span>26.20 MB/sec<span style=color:#f92672>)</span>, 1176.38 ms avg latency, 7117.00 ms max latency, <span style=color:#ae81ff>521</span> ms 50th, <span style=color:#ae81ff>4694</span> ms 95th, <span style=color:#ae81ff>6050</span> ms 99th, <span style=color:#ae81ff>6916</span> ms 99.9th.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>STEP3/4: Consumer performance test
</span></span><span style=display:flex><span>start.time, end.time, data.consumed.in.MB, MB.sec, data.consumed.in.nMsg, nMsg.sec, rebalance.time.ms, fetch.time.ms, fetch.MB.sec, fetch.nMsg.sec
</span></span><span style=display:flex><span>2021-12-09 16:09:05:331, 2021-12-09 16:09:39:913, 4768.3716, 137.8859, 5000000, 144583.8876, 1639037347941, -1639037313359, -0.0000, -0.0031
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>STEP4/4: Delete topic benchmark-topic
</span></span></code></pre></div><p>数据生产者测试结果：</p><ul><li>吞吐速率 26.20 MB/sec（27473.131278 records/sec (26.20 MB/sec)</li><li>数据平均延迟时间 1176.38 ms（1176.38 ms avg latency）</li><li>最大延迟时间 7117.00 ms（7117.00 ms max latency）</li></ul><p>数据消费者测试结果：</p><ul><li>data.consumed.in.MB 4768.3716 显示消费的所有消息的大小</li><li>MB.sec 137.8859 显示每秒传输的数据量（以兆字节为单位）（吞吐量大小）</li><li>data.consumed.in.nMsg 5000000 显示此测试期间消费的消息总数</li><li>nMsg.sec 144583.8876 显示一秒内消费了多少消息（消息计数的吞吐量）</li></ul><h2 id=常用运维命令>常用运维命令</h2><h4 id=kafka>Kafka</h4><p>启动 Kafka</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;~/kafka.sh start&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Starting kafka
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Starting kafka
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Starting kafka
</span></span></code></pre></div><p>停止 Kafka</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;~/kafka.sh stop&#39;</span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Shutting down kafka
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Shutting down kafka
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Shutting down kafka
</span></span></code></pre></div><p>查看 Kafka 状态</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;~/kafka.sh status&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Kafka is Running as PID: <span style=color:#ae81ff>19440</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Kafka is Running as PID: <span style=color:#ae81ff>20962</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Kafka is Running as PID: <span style=color:#ae81ff>25640</span>
</span></span></code></pre></div><p>创建 Topic</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible 10.1.207.177 -m shell -a <span style=color:#e6db74>&#39;kafka-topics.sh --create --topic testtopic --replication-factor 2 --partitions 6 --bootstrap-server 10.1.207.177:9003,10.1.207.178:9003,10.1.207.183:9003&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Created topic testtopic.
</span></span></code></pre></div><h4 id=zookeeper>Zookeeper</h4><p>启动 Zookeeper</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;~/zookeeper.sh start&#39;</span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Starting zookeeper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Starting zookeeper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Starting zookeeper
</span></span></code></pre></div><p>停止 Zookeeper</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;~/zookeeper.sh stop&#39;</span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Shutting down zookeeper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Shutting down zookeeper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Shutting down zookeeper
</span></span></code></pre></div><p>查看 Zookeeper 状态</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;~/zookeeper.sh status&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Zookeeper is Running as PID: <span style=color:#ae81ff>25589</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Zookeeper is Running as PID: <span style=color:#ae81ff>958</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Zookeeper is Running as PID: <span style=color:#ae81ff>26663</span>
</span></span></code></pre></div><p>输出可用于监控 Zookeeper 集群运行状况的变量列表</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;echo mntr | nc {{ inventory_hostname }} 2181&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>zk_version	3.5.9-83df9301aa5c2a5d284a9940177808c01bc35cef, built on 01/06/2021 20:03 GMT
</span></span><span style=display:flex><span>zk_avg_latency	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_max_latency	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_min_latency	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_packets_received	<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>zk_packets_sent	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>zk_num_alive_connections	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>zk_outstanding_requests	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_server_state	leader
</span></span><span style=display:flex><span>zk_znode_count	<span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>zk_watch_count	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_ephemerals_count	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_approximate_data_size	<span style=color:#ae81ff>191</span>
</span></span><span style=display:flex><span>zk_open_file_descriptor_count	<span style=color:#ae81ff>130</span>
</span></span><span style=display:flex><span>zk_max_file_descriptor_count	<span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>zk_followers	<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>zk_synced_followers	<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>zk_pending_syncs	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_last_proposal_size	-1
</span></span><span style=display:flex><span>zk_max_proposal_size	-1
</span></span><span style=display:flex><span>zk_min_proposal_size	-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>zk_version	3.5.9-83df9301aa5c2a5d284a9940177808c01bc35cef, built on 01/06/2021 20:03 GMT
</span></span><span style=display:flex><span>zk_avg_latency	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_max_latency	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_min_latency	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_packets_received	<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>zk_packets_sent	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>zk_num_alive_connections	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>zk_outstanding_requests	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_server_state	follower
</span></span><span style=display:flex><span>zk_znode_count	<span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>zk_watch_count	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_ephemerals_count	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_approximate_data_size	<span style=color:#ae81ff>191</span>
</span></span><span style=display:flex><span>zk_open_file_descriptor_count	<span style=color:#ae81ff>128</span>
</span></span><span style=display:flex><span>zk_max_file_descriptor_count	<span style=color:#ae81ff>100000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>zk_version	3.5.9-83df9301aa5c2a5d284a9940177808c01bc35cef, built on 01/06/2021 20:03 GMT
</span></span><span style=display:flex><span>zk_avg_latency	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_max_latency	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_min_latency	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_packets_received	<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>zk_packets_sent	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>zk_num_alive_connections	<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>zk_outstanding_requests	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_server_state	follower
</span></span><span style=display:flex><span>zk_znode_count	<span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>zk_watch_count	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_ephemerals_count	<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>zk_approximate_data_size	<span style=color:#ae81ff>191</span>
</span></span><span style=display:flex><span>zk_open_file_descriptor_count	<span style=color:#ae81ff>128</span>
</span></span><span style=display:flex><span>zk_max_file_descriptor_count	<span style=color:#ae81ff>100000</span>
</span></span></code></pre></div><p>显示 Zookeeper 配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;echo conf | nc {{ inventory_hostname }} 2181&#39;</span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>clientPort<span style=color:#f92672>=</span><span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>secureClientPort<span style=color:#f92672>=</span>-1
</span></span><span style=display:flex><span>dataDir<span style=color:#f92672>=</span>/data01/kafka/zookeeper_data/version-2
</span></span><span style=display:flex><span>dataDirSize<span style=color:#f92672>=</span><span style=color:#ae81ff>67108880</span>
</span></span><span style=display:flex><span>dataLogDir<span style=color:#f92672>=</span>/data01/kafka/zookeeper_datalog/version-2
</span></span><span style=display:flex><span>dataLogSize<span style=color:#f92672>=</span><span style=color:#ae81ff>5295</span>
</span></span><span style=display:flex><span>tickTime<span style=color:#f92672>=</span><span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>maxClientCnxns<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>minSessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>4000</span>
</span></span><span style=display:flex><span>maxSessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>40000</span>
</span></span><span style=display:flex><span>serverId<span style=color:#f92672>=</span><span style=color:#ae81ff>183</span>
</span></span><span style=display:flex><span>initLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>syncLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>electionAlg<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>electionPort<span style=color:#f92672>=</span><span style=color:#ae81ff>3888</span>
</span></span><span style=display:flex><span>quorumPort<span style=color:#f92672>=</span><span style=color:#ae81ff>2888</span>
</span></span><span style=display:flex><span>peerType<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>membership:
</span></span><span style=display:flex><span>server.177<span style=color:#f92672>=</span>10.1.207.177:2888:3888:participant
</span></span><span style=display:flex><span>server.178<span style=color:#f92672>=</span>10.1.207.178:2888:3888:participant
</span></span><span style=display:flex><span>server.183<span style=color:#f92672>=</span>10.1.207.183:2888:3888:participant
</span></span><span style=display:flex><span>version<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>clientPort<span style=color:#f92672>=</span><span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>secureClientPort<span style=color:#f92672>=</span>-1
</span></span><span style=display:flex><span>dataDir<span style=color:#f92672>=</span>/data01/kafka/zookeeper_data/version-2
</span></span><span style=display:flex><span>dataDirSize<span style=color:#f92672>=</span><span style=color:#ae81ff>67108880</span>
</span></span><span style=display:flex><span>dataLogDir<span style=color:#f92672>=</span>/data01/kafka/zookeeper_datalog/version-2
</span></span><span style=display:flex><span>dataLogSize<span style=color:#f92672>=</span><span style=color:#ae81ff>1715</span>
</span></span><span style=display:flex><span>tickTime<span style=color:#f92672>=</span><span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>maxClientCnxns<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>minSessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>4000</span>
</span></span><span style=display:flex><span>maxSessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>40000</span>
</span></span><span style=display:flex><span>serverId<span style=color:#f92672>=</span><span style=color:#ae81ff>177</span>
</span></span><span style=display:flex><span>initLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>syncLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>electionAlg<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>electionPort<span style=color:#f92672>=</span><span style=color:#ae81ff>3888</span>
</span></span><span style=display:flex><span>quorumPort<span style=color:#f92672>=</span><span style=color:#ae81ff>2888</span>
</span></span><span style=display:flex><span>peerType<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>membership:
</span></span><span style=display:flex><span>server.177<span style=color:#f92672>=</span>10.1.207.177:2888:3888:participant
</span></span><span style=display:flex><span>server.178<span style=color:#f92672>=</span>10.1.207.178:2888:3888:participant
</span></span><span style=display:flex><span>server.183<span style=color:#f92672>=</span>10.1.207.183:2888:3888:participant
</span></span><span style=display:flex><span>version<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>clientPort<span style=color:#f92672>=</span><span style=color:#ae81ff>2181</span>
</span></span><span style=display:flex><span>secureClientPort<span style=color:#f92672>=</span>-1
</span></span><span style=display:flex><span>dataDir<span style=color:#f92672>=</span>/data01/kafka/zookeeper_data/version-2
</span></span><span style=display:flex><span>dataDirSize<span style=color:#f92672>=</span><span style=color:#ae81ff>67108880</span>
</span></span><span style=display:flex><span>dataLogDir<span style=color:#f92672>=</span>/data01/kafka/zookeeper_datalog/version-2
</span></span><span style=display:flex><span>dataLogSize<span style=color:#f92672>=</span><span style=color:#ae81ff>2857</span>
</span></span><span style=display:flex><span>tickTime<span style=color:#f92672>=</span><span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>maxClientCnxns<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>minSessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>4000</span>
</span></span><span style=display:flex><span>maxSessionTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>40000</span>
</span></span><span style=display:flex><span>serverId<span style=color:#f92672>=</span><span style=color:#ae81ff>178</span>
</span></span><span style=display:flex><span>initLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>syncLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>electionAlg<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>electionPort<span style=color:#f92672>=</span><span style=color:#ae81ff>3888</span>
</span></span><span style=display:flex><span>quorumPort<span style=color:#f92672>=</span><span style=color:#ae81ff>2888</span>
</span></span><span style=display:flex><span>peerType<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>membership:
</span></span><span style=display:flex><span>server.177<span style=color:#f92672>=</span>10.1.207.177:2888:3888:participant
</span></span><span style=display:flex><span>server.178<span style=color:#f92672>=</span>10.1.207.178:2888:3888:participant
</span></span><span style=display:flex><span>server.183<span style=color:#f92672>=</span>10.1.207.183:2888:3888:participant
</span></span><span style=display:flex><span>version<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>列出与此服务器的连接详细信息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;echo cons | nc {{ inventory_hostname }} 2181&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span> /10.1.207.177:29094<span style=color:#f92672>[</span>0<span style=color:#f92672>](</span>queued<span style=color:#f92672>=</span>0,recved<span style=color:#f92672>=</span>1,sent<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span> /10.1.207.178:37550<span style=color:#f92672>[</span>0<span style=color:#f92672>](</span>queued<span style=color:#f92672>=</span>0,recved<span style=color:#f92672>=</span>1,sent<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span> /10.1.207.183:43808<span style=color:#f92672>[</span>0<span style=color:#f92672>](</span>queued<span style=color:#f92672>=</span>0,recved<span style=color:#f92672>=</span>1,sent<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>显示未完成的会话和临时节点。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;echo dump | nc {{ inventory_hostname }} 2181&#39;</span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>SessionTracker dump:
</span></span><span style=display:flex><span>Global Sessions<span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>ephemeral nodes dump:
</span></span><span style=display:flex><span>Sessions with Ephemerals <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>Connections dump:
</span></span><span style=display:flex><span>Connections Sets <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>/<span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> expire at Thu Dec <span style=color:#ae81ff>09</span> 10:27:03 CST 2021:
</span></span><span style=display:flex><span>	ip: /10.1.207.178:37608 sessionId: 0x0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>SessionTracker dump:
</span></span><span style=display:flex><span>Global Sessions<span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>ephemeral nodes dump:
</span></span><span style=display:flex><span>Sessions with Ephemerals <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>Connections dump:
</span></span><span style=display:flex><span>Connections Sets <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>/<span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> expire at Thu Dec <span style=color:#ae81ff>09</span> 10:25:25 CST 2021:
</span></span><span style=display:flex><span>	ip: /10.1.207.177:29470 sessionId: 0x0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>SessionTracker dump:
</span></span><span style=display:flex><span>Session Sets <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>/<span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>ephemeral nodes dump:
</span></span><span style=display:flex><span>Sessions with Ephemerals <span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>Connections dump:
</span></span><span style=display:flex><span>Connections Sets <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>/<span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> expire at Thu Dec <span style=color:#ae81ff>09</span> 10:26:55 CST 2021:
</span></span><span style=display:flex><span>	ip: /10.1.207.183:43966 sessionId: 0x0
</span></span></code></pre></div><p>显示环境设置。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;echo envi | nc {{ inventory_hostname }} 2181&#39;</span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Environment:
</span></span><span style=display:flex><span>zookeeper.version<span style=color:#f92672>=</span>3.5.9-83df9301aa5c2a5d284a9940177808c01bc35cef, built on 01/06/2021 20:03 GMT
</span></span><span style=display:flex><span>host.name<span style=color:#f92672>=</span>oss-irms-178
</span></span><span style=display:flex><span>java.version<span style=color:#f92672>=</span>1.8.0_202
</span></span><span style=display:flex><span>java.vendor<span style=color:#f92672>=</span>Oracle Corporation
</span></span><span style=display:flex><span>java.home<span style=color:#f92672>=</span>/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/jre
</span></span><span style=display:flex><span>java.class.path<span style=color:#f92672>=</span>.:/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/lib/dt.jar:/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/lib/tools.jar:/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/jre/lib::/opt/kafka/kafka_2.12-2.6.3/bin/../libs/activation-1.1.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/aopalliance-repackaged-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/argparse4j-0.7.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/audience-annotations-0.5.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/commons-cli-1.4.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/commons-lang3-3.8.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-api-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-basic-auth-extension-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-file-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-json-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-mirror-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-mirror-client-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-runtime-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-transforms-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/hk2-api-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/hk2-locator-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/hk2-utils-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-annotations-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-core-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-databind-2.10.5.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-dataformat-csv-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-datatype-jdk8-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-jaxrs-base-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-jaxrs-json-provider-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-module-jaxb-annotations-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-module-paranamer-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-module-scala_2.12-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.activation-api-1.2.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.annotation-api-1.3.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.inject-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.validation-api-2.0.2.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.ws.rs-api-2.1.6.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.xml.bind-api-2.3.2.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javassist-3.25.0-GA.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javassist-3.26.0-GA.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javax.servlet-api-3.1.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javax.ws.rs-api-2.1.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jaxb-api-2.3.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-client-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-common-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-container-servlet-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-container-servlet-core-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-hk2-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-media-jaxb-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-server-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-client-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-continuation-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-http-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-io-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-security-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-server-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-servlet-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-servlets-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-util-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-util-ajax-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jopt-simple-5.0.4.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka_2.12-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka_2.12-2.6.3-sources.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-clients-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-log4j-appender-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-examples-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-scala_2.12-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-test-utils-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-tools-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/log4j-1.2.17.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/lz4-java-1.7.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/maven-artifact-3.8.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/metrics-core-2.2.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-buffer-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-codec-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-common-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-handler-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-resolver-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-transport-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-transport-native-epoll-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-transport-native-unix-common-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/osgi-resource-locator-1.0.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/paranamer-2.8.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/plexus-utils-3.2.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/reflections-0.9.12.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/rocksdbjni-5.18.4.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-collection-compat_2.12-2.1.6.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-java8-compat_2.12-0.9.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-library-2.12.11.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-logging_2.12-3.9.2.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-reflect-2.12.11.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/slf4j-api-1.7.30.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/slf4j-log4j12-1.7.30.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/snappy-java-1.1.7.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/zookeeper-3.5.9.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/zookeeper-jute-3.5.9.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/zstd-jni-1.4.4-7.jar
</span></span><span style=display:flex><span>java.library.path<span style=color:#f92672>=</span>/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
</span></span><span style=display:flex><span>java.io.tmpdir<span style=color:#f92672>=</span>/tmp
</span></span><span style=display:flex><span>java.compiler<span style=color:#f92672>=</span>&lt;NA&gt;
</span></span><span style=display:flex><span>os.name<span style=color:#f92672>=</span>Linux
</span></span><span style=display:flex><span>os.arch<span style=color:#f92672>=</span>amd64
</span></span><span style=display:flex><span>os.version<span style=color:#f92672>=</span>3.10.0-957.el7.x86_64
</span></span><span style=display:flex><span>user.name<span style=color:#f92672>=</span>kafka
</span></span><span style=display:flex><span>user.home<span style=color:#f92672>=</span>/home/kafka
</span></span><span style=display:flex><span>user.dir<span style=color:#f92672>=</span>/home/kafka
</span></span><span style=display:flex><span>os.memory.free<span style=color:#f92672>=</span>1015MB
</span></span><span style=display:flex><span>os.memory.max<span style=color:#f92672>=</span>1024MB
</span></span><span style=display:flex><span>os.memory.total<span style=color:#f92672>=</span>1024MB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Environment:
</span></span><span style=display:flex><span>zookeeper.version<span style=color:#f92672>=</span>3.5.9-83df9301aa5c2a5d284a9940177808c01bc35cef, built on 01/06/2021 20:03 GMT
</span></span><span style=display:flex><span>host.name<span style=color:#f92672>=</span>cluster-endpoint
</span></span><span style=display:flex><span>java.version<span style=color:#f92672>=</span>1.8.0_202
</span></span><span style=display:flex><span>java.vendor<span style=color:#f92672>=</span>Oracle Corporation
</span></span><span style=display:flex><span>java.home<span style=color:#f92672>=</span>/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/jre
</span></span><span style=display:flex><span>java.class.path<span style=color:#f92672>=</span>.:/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/lib/dt.jar:/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/lib/tools.jar:/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/jre/lib::/opt/kafka/kafka_2.12-2.6.3/bin/../libs/activation-1.1.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/aopalliance-repackaged-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/argparse4j-0.7.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/audience-annotations-0.5.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/commons-cli-1.4.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/commons-lang3-3.8.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-api-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-basic-auth-extension-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-file-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-json-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-mirror-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-mirror-client-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-runtime-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-transforms-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/hk2-api-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/hk2-locator-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/hk2-utils-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-annotations-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-core-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-databind-2.10.5.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-dataformat-csv-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-datatype-jdk8-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-jaxrs-base-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-jaxrs-json-provider-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-module-jaxb-annotations-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-module-paranamer-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-module-scala_2.12-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.activation-api-1.2.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.annotation-api-1.3.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.inject-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.validation-api-2.0.2.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.ws.rs-api-2.1.6.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.xml.bind-api-2.3.2.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javassist-3.25.0-GA.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javassist-3.26.0-GA.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javax.servlet-api-3.1.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javax.ws.rs-api-2.1.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jaxb-api-2.3.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-client-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-common-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-container-servlet-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-container-servlet-core-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-hk2-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-media-jaxb-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-server-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-client-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-continuation-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-http-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-io-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-security-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-server-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-servlet-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-servlets-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-util-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-util-ajax-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jopt-simple-5.0.4.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka_2.12-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka_2.12-2.6.3-sources.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-clients-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-log4j-appender-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-examples-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-scala_2.12-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-test-utils-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-tools-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/log4j-1.2.17.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/lz4-java-1.7.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/maven-artifact-3.8.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/metrics-core-2.2.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-buffer-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-codec-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-common-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-handler-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-resolver-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-transport-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-transport-native-epoll-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-transport-native-unix-common-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/osgi-resource-locator-1.0.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/paranamer-2.8.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/plexus-utils-3.2.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/reflections-0.9.12.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/rocksdbjni-5.18.4.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-collection-compat_2.12-2.1.6.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-java8-compat_2.12-0.9.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-library-2.12.11.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-logging_2.12-3.9.2.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-reflect-2.12.11.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/slf4j-api-1.7.30.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/slf4j-log4j12-1.7.30.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/snappy-java-1.1.7.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/zookeeper-3.5.9.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/zookeeper-jute-3.5.9.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/zstd-jni-1.4.4-7.jar
</span></span><span style=display:flex><span>java.library.path<span style=color:#f92672>=</span>/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
</span></span><span style=display:flex><span>java.io.tmpdir<span style=color:#f92672>=</span>/tmp
</span></span><span style=display:flex><span>java.compiler<span style=color:#f92672>=</span>&lt;NA&gt;
</span></span><span style=display:flex><span>os.name<span style=color:#f92672>=</span>Linux
</span></span><span style=display:flex><span>os.arch<span style=color:#f92672>=</span>amd64
</span></span><span style=display:flex><span>os.version<span style=color:#f92672>=</span>3.10.0-957.el7.x86_64
</span></span><span style=display:flex><span>user.name<span style=color:#f92672>=</span>kafka
</span></span><span style=display:flex><span>user.home<span style=color:#f92672>=</span>/home/kafka
</span></span><span style=display:flex><span>user.dir<span style=color:#f92672>=</span>/home/kafka
</span></span><span style=display:flex><span>os.memory.free<span style=color:#f92672>=</span>977MB
</span></span><span style=display:flex><span>os.memory.max<span style=color:#f92672>=</span>1024MB
</span></span><span style=display:flex><span>os.memory.total<span style=color:#f92672>=</span>1024MB
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Environment:
</span></span><span style=display:flex><span>zookeeper.version<span style=color:#f92672>=</span>3.5.9-83df9301aa5c2a5d284a9940177808c01bc35cef, built on 01/06/2021 20:03 GMT
</span></span><span style=display:flex><span>host.name<span style=color:#f92672>=</span>oss-irms-183
</span></span><span style=display:flex><span>java.version<span style=color:#f92672>=</span>1.8.0_202
</span></span><span style=display:flex><span>java.vendor<span style=color:#f92672>=</span>Oracle Corporation
</span></span><span style=display:flex><span>java.home<span style=color:#f92672>=</span>/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/jre
</span></span><span style=display:flex><span>java.class.path<span style=color:#f92672>=</span>.:/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/lib/dt.jar:/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/lib/tools.jar:/opt/kafka/kafka_2.12-2.6.3/jdk1.8.0_202/jre/lib::/opt/kafka/kafka_2.12-2.6.3/bin/../libs/activation-1.1.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/aopalliance-repackaged-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/argparse4j-0.7.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/audience-annotations-0.5.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/commons-cli-1.4.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/commons-lang3-3.8.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-api-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-basic-auth-extension-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-file-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-json-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-mirror-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-mirror-client-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-runtime-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/connect-transforms-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/hk2-api-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/hk2-locator-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/hk2-utils-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-annotations-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-core-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-databind-2.10.5.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-dataformat-csv-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-datatype-jdk8-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-jaxrs-base-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-jaxrs-json-provider-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-module-jaxb-annotations-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-module-paranamer-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jackson-module-scala_2.12-2.10.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.activation-api-1.2.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.annotation-api-1.3.5.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.inject-2.6.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.validation-api-2.0.2.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.ws.rs-api-2.1.6.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jakarta.xml.bind-api-2.3.2.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javassist-3.25.0-GA.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javassist-3.26.0-GA.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javax.servlet-api-3.1.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/javax.ws.rs-api-2.1.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jaxb-api-2.3.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-client-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-common-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-container-servlet-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-container-servlet-core-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-hk2-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-media-jaxb-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jersey-server-2.31.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-client-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-continuation-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-http-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-io-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-security-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-server-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-servlet-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-servlets-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-util-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jetty-util-ajax-9.4.39.v20210325.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/jopt-simple-5.0.4.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka_2.12-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka_2.12-2.6.3-sources.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-clients-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-log4j-appender-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-examples-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-scala_2.12-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-streams-test-utils-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/kafka-tools-2.6.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/log4j-1.2.17.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/lz4-java-1.7.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/maven-artifact-3.8.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/metrics-core-2.2.0.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-buffer-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-codec-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-common-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-handler-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-resolver-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-transport-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-transport-native-epoll-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/netty-transport-native-unix-common-4.1.59.Final.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/osgi-resource-locator-1.0.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/paranamer-2.8.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/plexus-utils-3.2.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/reflections-0.9.12.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/rocksdbjni-5.18.4.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-collection-compat_2.12-2.1.6.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-java8-compat_2.12-0.9.1.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-library-2.12.11.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-logging_2.12-3.9.2.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/scala-reflect-2.12.11.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/slf4j-api-1.7.30.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/slf4j-log4j12-1.7.30.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/snappy-java-1.1.7.3.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/zookeeper-3.5.9.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/zookeeper-jute-3.5.9.jar:/opt/kafka/kafka_2.12-2.6.3/bin/../libs/zstd-jni-1.4.4-7.jar
</span></span><span style=display:flex><span>java.library.path<span style=color:#f92672>=</span>/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
</span></span><span style=display:flex><span>java.io.tmpdir<span style=color:#f92672>=</span>/tmp
</span></span><span style=display:flex><span>java.compiler<span style=color:#f92672>=</span>&lt;NA&gt;
</span></span><span style=display:flex><span>os.name<span style=color:#f92672>=</span>Linux
</span></span><span style=display:flex><span>os.arch<span style=color:#f92672>=</span>amd64
</span></span><span style=display:flex><span>os.version<span style=color:#f92672>=</span>3.10.0-957.el7.x86_64
</span></span><span style=display:flex><span>user.name<span style=color:#f92672>=</span>kafka
</span></span><span style=display:flex><span>user.home<span style=color:#f92672>=</span>/home/kafka
</span></span><span style=display:flex><span>user.dir<span style=color:#f92672>=</span>/home/kafka
</span></span><span style=display:flex><span>os.memory.free<span style=color:#f92672>=</span>1012MB
</span></span><span style=display:flex><span>os.memory.max<span style=color:#f92672>=</span>1024MB
</span></span><span style=display:flex><span>os.memory.total<span style=color:#f92672>=</span>1024MB
</span></span></code></pre></div><p>以字节为单位显示快照和日志文件的总大小。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;echo dirs | nc {{ inventory_hostname }} 2181&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>datadir_size: <span style=color:#ae81ff>67108880</span>
</span></span><span style=display:flex><span>logdir_size: <span style=color:#ae81ff>1715</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>datadir_size: <span style=color:#ae81ff>67108880</span>
</span></span><span style=display:flex><span>logdir_size: <span style=color:#ae81ff>2857</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>datadir_size: <span style=color:#ae81ff>67108880</span>
</span></span><span style=display:flex><span>logdir_size: <span style=color:#ae81ff>5295</span>
</span></span></code></pre></div><p>检查服务器是否以只读模式运行。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;echo isro | nc {{ inventory_hostname }} 2181&#39;</span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>rw
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>rw
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>rw
</span></span></code></pre></div><h2 id=q--a>Q & A</h2><h4 id=如何彻底删除-kafka-集群>如何彻底删除 Kafka 集群</h4><p>Q: 如何彻底删除使用自脚本安装的集群程序和数据</p><p>A: <code>~/kafka_uninstall.sh</code> 脚本将 <strong>kill -9 MySQL server 和 MySQL router，删除程序文件和所有数据文件</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bash-5.0# ansible all -m shell -a <span style=color:#e6db74>&#39;~/kafka_uninstall.sh&#39;</span>
</span></span><span style=display:flex><span>10.1.207.177 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Delete Kafka unzip directory
</span></span><span style=display:flex><span>Delete Kafka Data directory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.178 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Delete Kafka unzip directory
</span></span><span style=display:flex><span>Delete Kafka Data directory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.1.207.183 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
</span></span><span style=display:flex><span>Delete Kafka unzip directory
</span></span><span style=display:flex><span>Delete Kafka Data directory
</span></span></code></pre></div><h4 id=生产环境>生产环境</h4><p><strong>CPUs：</strong> Kafka 对 CPU 要求较低（除非你开启了 SSL），建议使用不低于 24 核的 CPUs</p><p><strong>内存：</strong> Kafka 严重依赖文件系统和内存，建议使用不低于 32GB 内存的机器（64GB最好）。</p><p><strong>磁盘：</strong> 不要与应用程序日志或者其他操作系统文件系统共享 Kafka 数据盘，以确保最小的延迟。最优策略为每个节点使用 RAID5 或者 RAID10 挂载数据目录，每个逻辑盘不超过 8 块（对于大多数用例，建议将 RAID 10 作为最佳选项。它提供了改进的读写性能、数据保护和快速重建时间）。</p><p>你也可以挂载多块磁盘来最大化吞吐量，并且设置参数 <code>num.io.thread</code> 与挂盘数一致，估算算法如下：</p><p>每个节点挂盘数 &lt;= CPU逻辑核数 / 2</p><p><strong>网络：</strong></p><p>快速可靠的网络是分布式系统中必不可少的性能组件。低延迟确保节点可以轻松通信，而高带宽有助于分片移动和恢复。现代数据中心网络（1 GbE、10 GbE）足以满足绝大多数集群的需求。建议使用<a href=https://coolbeevip.github.io/posts/linux/linux-commands-network/>iperf</a>先测试一下。</p><p><strong>文件系统：</strong> 建议在 XFS 或 ext4 上运行 Kafka</p><p><strong>JVM：</strong> 不需要设置超过 6 GB 的堆大小。这将导致 32 GB 机器上的文件系统缓存高达 28-30 GB，您需要足够的内存来缓冲活动的读取器和写入器。你可以用一下公示估算：</p><ul><li>每秒吞度量 = 每条消息字节数 * 每秒消息数；</li></ul><p>例如：每条消息字节数 600 字节，每秒消息数 17000，那么吞吐率大概为 10MB/秒</p><ul><li>缓冲大小 = 需要缓冲的时间 * 每秒吞度量 / (Topic 分区数 * 副本数)；</li></ul><p>例如：需要缓冲 30 秒，每秒吞吐率 10MB，Topic 5 个分区，3 个副本，那么需要缓冲区为 180MB</p></div><div class=post-footer><div class=info><span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/kafka/>kafka</a></span></div></div></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.e1c6918cbaa90022a5612f0bd71c7bf3be6d036614c5729cebfe14f7b91fa4bc.js integrity="sha256-4caRjLqpACKlYS8L1xx7875tA2YUxXKc6/4U97kfpLw=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css integrity=sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js integrity=sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js integrity=sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v crossorigin=anonymous onload=renderMathInElement(document.body)></script></body></html>