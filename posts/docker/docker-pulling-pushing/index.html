<!doctype html><html lang=en data-theme><head><title>Lei Zhang | Synchronize between image repositories with Bash</title><meta charset=utf-8><meta name=generator content="Hugo 0.112.5"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="This is my knowledge base. I document things here"><link rel=stylesheet href=/css/style.min.7cf3c5090ac13256a5fa5531e5649cfe5a2ba7de88dca14ce0b6e253409a3511.css integrity="sha256-fPPFCQrBMlal+lUx5WSc/lorp96I3KFM4LbiU0CaNRE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.3fa691134fafa8351e9d193939a352647c1ae886828bdefa3f5a272653dbf7e4.css integrity="sha256-P6aRE0+vqDUenRk5OaNSZHwa6IaCi976P1onJlPb9+Q=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=/posts/docker/docker-pulling-pushing/><script type=text/javascript src=/js/anatole-header.min.df804b63b5bd8474ea0756ea874bc8f1e92552708cc6ea43aa0d76981dc419f9.js integrity="sha256-34BLY7W9hHTqB1bqh0vI8eklUnCMxupDqg12mB3EGfk=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Synchronize between image repositories with Bash"><meta name=twitter:description content="从源镜像仓库批量拉取镜像，并将这些镜像推送到目标镜像仓库的批量脚本
#!/bin/bash ################################################# # 使用方式 # 从源仓库拉取镜像到本机 # sh docker-images-pulling-pushing.sh pull # # 将本机镜像推送到目的仓库 # sh docker-images-pulling-pushing.sh push # # 清理本机的镜像 # sh docker-images-pulling-pushing.sh clean ################################################# # 源仓库地址 DOCKER_REPO_FROM= # 目标仓库地址 DOCKER_REPO_TO=192.168.2.2:8888/ DOCKER_REPO_TO_USER=test DOCKER_REPO_TO_PASS=Test123456 # 镜像定义 DOCKER_IMAGES=() DOCKER_IMAGES+=(postgres:9.6) DOCKER_IMAGES+=(elasticsearch:6.6.2) DOCKER_IMAGES+=(coolbeevip/servicecomb-pack) # 从源仓库地址拉取镜像到本机仓库 function pull(){ echo &#34;Pull images from $DOCKER_REPO_FROM&#34; for image in ${DOCKER_IMAGES[@]}; do docker pull $DOCKER_REPO_FROM$image done } # 本机镜像推送到目的仓库 function push(){ docker login http://$DOCKER_REPO_TO -u $DOCKER_REPO_TO_USER -p $DOCKER_REPO_TO_PASS echo &#34;Push $DOCKER_REPO_FROM to $DOCKER_REPO_TO&#34; for image in ${DOCKER_IMAGES[@]}; do docker image tag $DOCKER_REPO_FROM$image $DOCKER_REPO_TO$image docker push $DOCKER_REPO_TO$image done } # 清理本机拉取后的镜像 function clean(){ echo &#34;Remove images&#34; docker rmi -f $(docker images | grep $DOCKER_REPO_FROM | awk '{print $3}') docker rmi -f $(docker images | grep $DOCKER_REPO_TO | awk '{print $3}') } case &#34;${@: -1}&#34; in pull ) pull ;; clean ) clean ;; push ) push ;; esac "></head><body><div class="sidebar ."><div class=logo-title><div class=title><img src=/images/profile.jpg alt="profile picture"><h3 title><a href=/>I'm Lei Zhang</a></h3><div class=description><p>This is my knowledge base. I document things here</p></div></div><p><a href=https://github.com/coolbeevip><img src="https://img.shields.io/github/followers/coolbeevip?label=follow&amp;style=social" alt="GitHub coolbeevip"></a>
<img src=https://badges.pufler.dev/commits/all/coolbeevip alt="Commits Badge">
<img src=https://badges.pufler.dev/repos/coolbeevip alt="Repos Badge">
<img src=https://badges.pufler.dev/years/coolbeevip alt="Years Badge"></p></div><ul class=social-links><li><a href=https://github.com/coolbeevip/ rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:zhanglei@apache.org rel=me aria-label=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Lei Zhang 2023</div></div></div><div class=main><div class="page-top ."><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a href=/ title>Home</a></li><li><a href=/posts title>Blog</a></li><li><a href=/bookmarks title>Bookmarks</a></li><li><a href=/about/ title>About</a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post ."><div class=post-content><div class=post-title><h3>Synchronize between image repositories with Bash</h3></div><p>从源镜像仓库批量拉取镜像，并将这些镜像推送到目标镜像仓库的批量脚本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#################################################</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用方式</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  从源仓库拉取镜像到本机</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  sh docker-images-pulling-pushing.sh pull</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  将本机镜像推送到目的仓库</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  sh docker-images-pulling-pushing.sh push</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  清理本机的镜像</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  sh docker-images-pulling-pushing.sh clean</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#################################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 源仓库地址</span>
</span></span><span style=display:flex><span>DOCKER_REPO_FROM<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 目标仓库地址</span>
</span></span><span style=display:flex><span>DOCKER_REPO_TO<span style=color:#f92672>=</span>192.168.2.2:8888/
</span></span><span style=display:flex><span>DOCKER_REPO_TO_USER<span style=color:#f92672>=</span>test
</span></span><span style=display:flex><span>DOCKER_REPO_TO_PASS<span style=color:#f92672>=</span>Test123456
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 镜像定义</span>
</span></span><span style=display:flex><span>DOCKER_IMAGES<span style=color:#f92672>=()</span>
</span></span><span style=display:flex><span>DOCKER_IMAGES<span style=color:#f92672>+=(</span>postgres:9.6<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>DOCKER_IMAGES<span style=color:#f92672>+=(</span>elasticsearch:6.6.2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>DOCKER_IMAGES<span style=color:#f92672>+=(</span>coolbeevip/servicecomb-pack<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 从源仓库地址拉取镜像到本机仓库</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> pull<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Pull images from </span>$DOCKER_REPO_FROM<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> image in <span style=color:#e6db74>${</span>DOCKER_IMAGES[@]<span style=color:#e6db74>}</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    docker pull $DOCKER_REPO_FROM$image
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 本机镜像推送到目的仓库</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> push<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>  docker login http://$DOCKER_REPO_TO -u $DOCKER_REPO_TO_USER -p $DOCKER_REPO_TO_PASS
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Push </span>$DOCKER_REPO_FROM<span style=color:#e6db74> to </span>$DOCKER_REPO_TO<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> image in <span style=color:#e6db74>${</span>DOCKER_IMAGES[@]<span style=color:#e6db74>}</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    docker image tag $DOCKER_REPO_FROM$image $DOCKER_REPO_TO$image
</span></span><span style=display:flex><span>    docker push $DOCKER_REPO_TO$image
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 清理本机拉取后的镜像</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> clean<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;Remove images&#34;</span>
</span></span><span style=display:flex><span>  docker rmi -f <span style=color:#66d9ef>$(</span>docker images | grep $DOCKER_REPO_FROM | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>  docker rmi -f <span style=color:#66d9ef>$(</span>docker images | grep $DOCKER_REPO_TO | awk <span style=color:#e6db74>&#39;{print $3}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>@: -1<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> in
</span></span><span style=display:flex><span>	pull <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		pull
</span></span><span style=display:flex><span>		;;
</span></span><span style=display:flex><span>  clean <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		clean
</span></span><span style=display:flex><span>		;;
</span></span><span style=display:flex><span>	push <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		push
</span></span><span style=display:flex><span>		;;
</span></span><span style=display:flex><span><span style=color:#66d9ef>esac</span>
</span></span></code></pre></div></div><div class=post-footer><div class=info><span class=separator><a class=category href=/categories/docker/>docker</a></span>
<span class=separator><a class=tag href=/tags/docker/>docker</a></span></div></div></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.e1c6918cbaa90022a5612f0bd71c7bf3be6d036614c5729cebfe14f7b91fa4bc.js integrity="sha256-4caRjLqpACKlYS8L1xx7875tA2YUxXKc6/4U97kfpLw=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css integrity=sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js integrity=sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js integrity=sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v crossorigin=anonymous onload=renderMathInElement(document.body)></script></body></html>