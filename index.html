<!doctype html><html lang=en data-theme><head><title>Lei Zhang</title><meta charset=utf-8><meta name=generator content="Hugo 0.83.1"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="This is my knowledge base. I document things here"><link rel=stylesheet href=/css/style.min.7cf3c5090ac13256a5fa5531e5649cfe5a2ba7de88dca14ce0b6e253409a3511.css integrity="sha256-fPPFCQrBMlal+lUx5WSc/lorp96I3KFM4LbiU0CaNRE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.f856cb76c8381a437165165d0265ca1d221f2441b9d80f02627f02fed271048d.css integrity="sha256-+FbLdsg4GkNxZRZdAmXKHSIfJEG52A8CYn8C/tJxBI0=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=/><link rel=alternate type=application/rss+xml href=/index.xml title><script type=text/javascript src=/js/anatole-header.min.0c05c0a90d28c968a1cad4fb31abd0b8e1264e788ccefed022ae1d3b6f627514.js integrity="sha256-DAXAqQ0oyWihytT7MavQuOEmTniMzv7QIq4dO29idRQ=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="This is my knowledge base. I document things here"></head><body><div class="sidebar animated fadeInDown"><div class=logo-title><div class=title><img src=/images/profile.jpg alt="profile picture"><h3 title><a href=/>I'm Lei Zhang</a></h3><div class=description><p>This is my knowledge base. I document things here</p></div></div></div><ul class=social-links><li><a href=https://github.com/coolbeevip/ rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:zhanglei@apache.org rel=me aria-label=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Lei Zhang 2021</div></div></div><div class=main><div class="page-top animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a class=current href=/ title>Home</a></li><li><a href=/about/ title>About</a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post animated fadeInDown"></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/securing-docker-ports-with-firewalld/>使用 Firewalld 保护 Docker 端口</a></h3></div><div class=post-content><div class=p_part><p>概述 为了保护 Docker 暴露的端口不受外部访问的影响，可以使用 firewalld 配置防火墙规则，只允许特定的 IP 访问。 通过让 firewalld 创建 DOCKER-USER 链，我们可以实现由 firewalld 维护的安全 Docker 端口, Docker 处理 iptables 规则以提供网络隔离，更多详细
本文基于环境
Docker-CE 19.03.12 CentOS Linux release 7.8.2003 Firewall 0.6.3 本文例子:
我们使用 Docker 安装一个 Nginx，并将 80(HTTP) 端口对外映射为 8080，443(HTTPS) 端口对外映射为 8443，并通过 Firewalld 仅允许特定的 IP 访问；提示：后续的防火墙规则中配置的端口是容器内部端口，例如 80，443
192.168.51.246 安装 Nginx Docker
配置 192.168.51.245 可以访问 Nginx Docker
其他机器无法访问 Nginx Docker
重要的事情说三遍
如果你在 Docker 运行时重启 firewalld，那么 firewalld 将删除 DOCKER-USER</p><a href=/posts/securing-docker-ports-with-firewalld/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Tue, May 11, 2021</span>
<span class=separator><a class=category href=/categories/docker/>docker</a><a class=category href=/categories/firewalld/>firewalld</a><a class=category href=/categories/centos/>centos</a></span></div></div></div></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/maven-export-dependencies-analyse-license/>导出 Maven 项目的依赖报告并分析 LICENSE 信息</a></h3></div><div class=post-content><div class=p_part><p>有的时候我们那需要分析多模块 Maven 项目的依赖使用情况，并希望能够分析出这些依赖的 LICENSE 信息。使用 io.github.coolbeevip:license-maven-plugin 插件 可以生成 TXT 或者 CSV 格式的分析报告
youtube
bilibili
CSV 格式的报告 NOTICE.CSV NOTICE-LICENSE.CSV TXT 格式的报告 NOTICE.TXT NOTICE-LICENSE.TXT 插件 LICENSE-MAVEN-PLUGIN format 导出格式，支持 csv、txt； license 是否分析 LICENSE 信息，默认 false； ignoreGroupIds 忽略 groupId 列表, 多个用逗号分割; timeout 分析 LICENSE 的超时时间，默认 5 秒; 导出报告 在 Maven 项目的根目录执行如下命令
导出 CSV
mvn io.github.coolbeevip:license-maven-plugin:1.5.0:dependency-license-export -Dformat=csv 导出 TXT
mvn io.github.coolbeevip:license-maven-plugin:1.5.0:dependency-license-export -Dformat=txt 提示： 导出的报告位置在 ./target/distribute 目录下
导出报告(忽略部分依赖) mvn io.github.coolbeevip:license-maven-plugin:1.5.0:dependency-license-export -Dformat=csv -DignoreGroupIds=org.</p><a href=/posts/maven-export-dependencies-analyse-license/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Sun, May 9, 2021</span>
<span class=separator><a class=category href=/categories/maven/>maven</a><a class=category href=/categories/license/>license</a><a class=category href=/categories/opensource/>opensource</a></span></div></div></div></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/docker-pulling-pushing/>Docker Pulling Pushing Batch Shell Script</a></h3></div><div class=post-content><div class=p_part><p>从源镜像仓库批量拉取镜像，并将这些镜像推送到目标镜像仓库的批量脚本
#!/bin/bash ################################################# # 使用方式 # 从源仓库拉取镜像到本机 # sh docker-images-pulling-pushing.sh pull # # 将本机镜像推送到目的仓库 # sh docker-images-pulling-pushing.sh push # # 清理本机的镜像 # sh docker-images-pulling-pushing.sh clean ################################################# # 源仓库地址 DOCKER_REPO_FROM= # 目标仓库地址 DOCKER_REPO_TO=192.168.2.2:8888/ DOCKER_REPO_TO_USER=test DOCKER_REPO_TO_PASS=Test123456 # 镜像定义 DOCKER_IMAGES=() DOCKER_IMAGES+=(postgres:9.6) DOCKER_IMAGES+=(elasticsearch:6.6.2) DOCKER_IMAGES+=(coolbeevip/servicecomb-pack) # 从源仓库地址拉取镜像到本机仓库 function pull(){ echo "Pull images from $DOCKER_REPO_FROM" for image in ${DOCKER_IMAGES[@]}; do docker pull $DOCKER_REPO_FROM$image done } # 本机镜像推送到目的仓库 function push(){ docker login http://$DOCKER_REPO_TO -u $DOCKER_REPO_TO_USER -p $DOCKER_REPO_TO_PASS echo "Push $DOCKER_REPO_FROMto $DOCKER_REPO_TO" for image in ${DOCKER_IMAGES[@]}; do docker image tag $DOCKER_REPO_FROM$image $DOCKER_REPO_TO$image docker push $DOCKER_REPO_TO$image done } # 清理本机拉取后的镜像 function clean(){ echo "Remove images" docker rmi -f $(docker images | grep $DOCKER_REPO_FROM | awk '{print $3}') docker rmi -f $(docker images | grep $DOCKER_REPO_TO | awk '{print $3}') } case "${@: -1}" in pull ) pull ;; clean ) clean ;; push ) push ;; esac</p></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Mon, Apr 19, 2021</span>
<span class=separator><a class=category href=/categories/docker/>docker</a><a class=category href=/categories/shell/>shell</a></span></div></div></div></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/mysql-commands/>常用 MySQL 命令</a></h3></div><div class=post-content><div class=p_part><p>常用 MySQL 命令
连接数配置 查看允许的最大连接数 show variables like '%max_connection%'; 如果过去曾达到此限制，则可以使用以下方法检查 SHOW GLOBAL STATUS LIKE 'max_use%'; 配置用户的最大并发连接数 GRANT USAGE ON *.* TO 'repl'@'%' WITH MAX_CONNECTIONS_PER_HOUR 100 MAX_USER_CONNECTIONS 10; 查看用户的最大并发连接数 SELECT User, Host, max_connections, max_user_connections FROM mysql.user; 设置最大连接数 set global max_connections=1000; 查看当前连接数 show status like 'Threads%'; Threads_cached 当前线程池中缓存有多少空闲线程 Threads_connected 当前的连接数 ( 也就是线程数 ) Threads_running 已经创建的线程总数 Threads_created 当前激活的线程数 ( Threads_connected 中的线程有些可能处于休眠状态 ) thread_cache_size 值过小会导致频繁创建线程，直接反映就是 show status 查看 Threads_created 值过大。 当 Threads_cached 越来越少 但 Threads_connected 始终不降 且 Threads_created 持续升高 这时可适当增加 thread_cache_size 的大小</p><a href=/posts/mysql-commands/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Mon, May 11, 2020</span>
<span class=separator><a class=category href=/categories/mysql/>mysql</a></span></div></div></div></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/best-practices-for-structuring-maven-projects-and-modules/>Maven项目和模块的最佳实践</a></h3></div><div class=post-content><div class=p_part><p>本文整理构建Maven项目和模块的最佳实践的关键事项，其中包含依赖、版本、属性、模块划分等关键因素，推荐使用 Maven 3.6.3 及以上版本。 为了便于理解，我们假设有一个 API 网关项目，这个网关项目包含服务端、客户端、通知服务端支持插件。
目标 通过多模块方式组织项目 管理项目版本、依赖，属性 规划模块依赖关系 主项目 POM 每个项目都应该在项目根目录下有一个主 POM 文件，并通过主 POM 文件管理下级子模块。在主 POM 中至少会使用一下标签
properties: 定义字符集编码、JDK 版本、插件版本; modules: 下级子模块; pluginRepositories: 插件仓库地址（非必须，主要解决国内访问慢的问题）; repositories: 定义 Maven 私服地址; distributionManagement: 定义发布用 Maven 私服地址 pluginManagement: 定义管理类插件版本 例如：
&lt;?xml version="1.0" encoding="UTF-8"?> &lt;build xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"> &lt;modelVersion>4.0.0&lt;/modelVersion> &lt;groupId>com.coolbeevip.apigateway&lt;/groupId> &lt;artifactId>apigateway-parent&lt;/artifactId> &lt;version>1.0.0-SNAPSHOT&lt;/version> &lt;packaging>pom&lt;/packaging> &lt;properties> &lt;!-- project --> &lt;project.build.sourceEncoding>UTF-8&lt;/project.build.sourceEncoding> &lt;project.reporting.outputEncoding>UTF-8&lt;/project.reporting.outputEncoding> &lt;maven.compiler.encoding>UTF-8&lt;/maven.compiler.encoding> &lt;maven.compiler.source>8&lt;/maven.compiler.source> &lt;maven.compiler.target>8&lt;/maven.compiler.target> &lt;!-- plugins version --> &lt;maven-compiler-plugin.version>3.1&lt;/maven-compiler-plugin.version> &lt;jacoco-maven-plugin.version>0.8.6&lt;/jacoco-maven-plugin.version> &lt;docker-maven-plugin.</p><a href=/posts/best-practices-for-structuring-maven-projects-and-modules/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Sat, May 2, 2020</span>
<span class=separator><a class=category href=/categories/maven/>maven</a><a class=category href=/categories/java/>java</a><a class=category href=/categories/project/>project</a></span></div></div></div></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/git-command-rebase-upstream/>Git Fork 后同步上游分支</a></h3></div><div class=post-content><div class=p_part><p>当你 fork 一个仓库后，可以时用此方法使你 fork 后的仓库 master 分支保持和上游 master 分支的同步
使用 rebase 命令同步上游 master 分支到你本地的 master 分支，并推送到你 fork 后的仓库
git fetch upstream git checkout master git rebase upstream/master git push -f origin master 或者你确定放弃你本地所有的修改，则可以简单的重置为上游版本
git fetch upstream git checkout master git reset --hard upstream/master git push -f origin master 如果你也想同步 master 分支的修改到你的功能分支
git checkout &lt;分支名> git rebase master git push -f origin &lt;分支名></p></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Mon, Apr 6, 2020</span>
<span class=separator><a class=category href=/categories/git/>git</a></span></div></div></div></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/git-command-commit-squash/>Git Squash Commits</a></h3></div><div class=post-content><div class=p_part><p>压缩合并 Commits，将多个 commit 整理合并的方法，这样可以使提交记录更加清晰
查看提交记录，选择你要合并的范围 git log commit 6d757f70af289b5a90d00bd5e4b93d892d64a258 (HEAD -> SCB-1669) Author: Lei Zhang &lt;zhanglei@apache.org> Date: Thu Dec 19 13:53:26 2019 +0800 SCB-1669 Fixed reverse compensation sort bug in FSM commit 37e0c5d99d0e6dae188cbd78f543ba69433b928f (origin/SCB-1669) Author: Lei Zhang &lt;zhanglei@apache.org> Date: Thu Dec 19 02:00:20 2019 +0800 SCB-1669 Fixed Reverse compensation sort bug in FSM commit b4ea8717a86d1eba1956d21727d05c466ff6d8a2 (upstream/master, origin/master, origin/HEAD, master) Author: Lei Zhang &lt;zhanglei@apache.org> Date: Tue Dec 10 16:25:48 2019 +0800 SCB-1658 Improve encapsulation on txEntityMap of SagaData 可以看到最后两次提交，都是为了修复 SCB-1669 这个问题，此时我想合并最后两次提交 6d757f70af289b5a90d00bd5e4b93d892d64a258 和 37e0c5d99d0e6dae188cbd78f543ba69433b928f</p><a href=/posts/git-command-commit-squash/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Mon, Apr 6, 2020</span>
<span class=separator><a class=category href=/categories/git/>git</a></span></div></div></div></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/git-command-commit-stash/>Git Stash</a></h3></div><div class=post-content><div class=p_part><p>你在当前分支上开发代码，此时不想 commit，但是又想切换到其他分支完成其他的工作，此时可以用 stash
在当前分支执行 stash 将当前分支未提交的代码隐藏起来 $ git stash Saved working directory and index state WIP on SCB-1577: 2554be3d SCB-1593 Add notice for Boringssl support ciphers (base) bogon:servicecomb-pack zhanglei$ 此时你可以看到已经存储到一个id为 2554be3d 里了，这时你可以用 git status 查看已经没有要提交的内容了
git status On branch SCB-1577 nothing to commit, working tree clean (base) bogon:servicecomb-pack zhanglei$ 这时你就可以切换到其他分支开始新的工作 (base) bogon:servicecomb-pack zhanglei$ git checkout master Switched to branch 'master' Your branch is up to date with 'origin/master'.</p><a href=/posts/git-command-commit-stash/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Mon, Apr 6, 2020</span>
<span class=separator><a class=category href=/categories/git/>git</a></span></div></div></div></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/linux-commands-check/>常用 Linux 检测命令</a></h3></div><div class=post-content><div class=p_part><p>IO 磁盘IO测试
[root@localhost ~]# dd if=/dev/zero of=./a.dat bs=8K count=1M conv=fdatasync 记录了8192+0 的读入 记录了8192+0 的写出 8589934592字节(8.6 GB)已复制，14.8606 秒，578 MB/秒 [root@localhost ~]# dd if=./a.dat of=/dev/null bs=1M count=8k iflag=direct 记录了8192+0 的读入 记录了8192+0 的写出 8589934592字节(8.6 GB)已复制，14.2462 秒，603 MB/秒</p></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Mon, May 6, 2019</span>
<span class=separator><a class=category href=/categories/linux/>linux</a></span></div></div></div></div><div class="post animated fadeInDown"><div class=post-title><h3><a href=/posts/git-commands/>常用 Git 命令</a></h3></div><div class=post-content><div class=p_part><p>常用 Git 命令
Branch 创建分支
git checkout -b &lt;分支名> 推送分支
git push origin &lt;分支名> 修改分支名
git branch -m &lt;旧分支名> &lt;新分支名> 删除本地分支
git branch -D &lt;分支名> 删除远程分支
git push origin --delete &lt;分支名> 拉取远程分支
git fetch origin &lt;分支名> 拉取远程分支并切换
git checkout -b &lt;分支名> origin/&lt;分支名> 当前分支会退到指定版本
git reset --hard &lt;版本号的sha1> Tag 创建本地 Tag
git tag -a &lt;标签名> -m "my tag" 删除本地 Tag
git tag -d &lt;标签名> 删除远程 Tag
git push origin :refs/tags/&lt;标签名> 推送本地所有 Tag 到远程</p><a href=/posts/git-commands/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em><span class=date>Sat, Apr 6, 2019</span>
<span class=separator><a class=category href=/categories/git/>git</a></span></div></div></div></div><div class=pagination><ul class=pagination><li class=page-item><a href=/ class=page-link aria-label=First><span aria-hidden=true>&#171;&#171;</span></a></li><li class="page-item disabled"><a class=page-link aria-label=Previous><span aria-hidden=true>&#171;</span></a></li><li class="page-item active"><a class=page-link href=/>1</a></li><li class=page-item><a class=page-link href=/page/2/>2</a></li><li class=page-item><a href=/page/2/ class=page-link aria-label=Next><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/2/ class=page-link aria-label=Last><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.2d6fd0be87fa98f0c9b4dc2536b312bbca48757f584f6ea1f394abc9bcc38fbc.js integrity="sha256-LW/Qvof6mPDJtNwlNrMSu8pIdX9YT26h85SrybzDj7w=" crossorigin=anonymous></script></body></html>