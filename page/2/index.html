<!doctype html><html lang=en data-theme><head><title>Lei Zhang</title><meta charset=utf-8><meta name=generator content="Hugo 0.99.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="This is my knowledge base. I document things here"><link rel=stylesheet href=/css/style.min.7cf3c5090ac13256a5fa5531e5649cfe5a2ba7de88dca14ce0b6e253409a3511.css integrity="sha256-fPPFCQrBMlal+lUx5WSc/lorp96I3KFM4LbiU0CaNRE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.3fa691134fafa8351e9d193939a352647c1ae886828bdefa3f5a272653dbf7e4.css integrity="sha256-P6aRE0+vqDUenRk5OaNSZHwa6IaCi976P1onJlPb9+Q=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=/><link rel=alternate type=application/rss+xml href=/index.xml title><script type=text/javascript src=/js/anatole-header.min.df804b63b5bd8474ea0756ea874bc8f1e92552708cc6ea43aa0d76981dc419f9.js integrity="sha256-34BLY7W9hHTqB1bqh0vI8eklUnCMxupDqg12mB3EGfk=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="This is my knowledge base. I document things here"></head><body><div class="sidebar ."><div class=logo-title><div class=title><img src=/images/profile.jpg alt="profile picture"><h3 title><a href=/>I'm Lei Zhang</a></h3><div class=description><p>This is my knowledge base. I document things here</p></div></div><p><a href=https://github.com/coolbeevip><img src="https://img.shields.io/github/followers/coolbeevip?label=follow&style=social" alt="GitHub coolbeevip"></a>
<img src=https://badges.pufler.dev/commits/all/coolbeevip alt="Commits Badge">
<img src=https://badges.pufler.dev/repos/coolbeevip alt="Repos Badge">
<img src=https://badges.pufler.dev/years/coolbeevip alt="Years Badge"></p></div><ul class=social-links><li><a href=https://github.com/coolbeevip/ rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:zhanglei@apache.org rel=me aria-label=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Lei Zhang 2022</div></div></div><div class=main><div class="page-top ."><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a class=current href=/ title>Home</a></li><li><a href=/posts title>Blog</a></li><li><a href=/bookmarks title>Bookmarks</a></li><li><a href=/about/ title>About</a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post ."></div><div class="post ."><div class=post-title><h3><a href=/posts/maven/maven-using-owasp-dependency-vulnerabilities-check/>Using OWASP Dependency Vulnerabilities Check with Maven</a></h3></div><div class=post-content><div class=p_part><p>使用 OWASP 依赖检查 Maven 插件 dependency-check-maven 发现依赖漏洞
增加编译插件 在 pom.xml 中增加如下配置，如果是多模块项目请增加在最外层 pom.xml 中，并且配置 &lt;goal> 为 aggregate
&lt;properties> &lt;dependency-check-maven.version>6.5.3&lt;/dependency-check-maven.version> &lt;/properties> &lt;build> &lt;plugins> &lt;plugin> &lt;groupId>org.owasp&lt;/groupId> &lt;artifactId>dependency-check-maven&lt;/artifactId> &lt;version>${dependency-check-maven.version}&lt;/version> &lt;configuration> &lt;name>notifier-dependency-check&lt;/name> &lt;format>HTML&lt;/format> &lt;failBuildOnCVSS>9&lt;/failBuildOnCVSS> &lt;failOnError>false&lt;/failOnError> &lt;skipProvidedScope>true&lt;/skipProvidedScope> &lt;skipRuntimeScope>true&lt;/skipRuntimeScope> &lt;skipTestScope>true&lt;/skipTestScope> &lt;retireJsAnalyzerEnabled>false&lt;/retireJsAnalyzerEnabled> &lt;skipArtifactType>pom&lt;/skipArtifactType> &lt;/configuration> &lt;executions> &lt;execution> &lt;goals> &lt;goal>aggregate&lt;/goal> &lt;/goals> &lt;/execution> &lt;/executions> &lt;/plugin> &lt;/plugins> &lt;/build> failBuildOnCVSS 当发现此级别的漏洞后编译失败，评分和严重等级如下</p><a href=/posts/maven/maven-using-owasp-dependency-vulnerabilities-check/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Thu, Feb 24, 2022</span>
<span class=separator><a class=category href=/categories/java/>java</a></span>
<span class=separator><a class=tag href=/tags/maven/>maven</a><a class=tag href=/tags/vulnerabilities/>vulnerabilities</a><a class=tag href=/tags/owasp/>owasp</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/kubernetes/run-docker-without-docker-desktop-on-macos/>Run Docker without Docker Desktop on macOS</a></h3></div><div class=post-content><div class=p_part><p>由于 Docker Desktop 修改了授权条款，不再对企业用户免费，所以我们需要啊寻求一种替代品。到目前为止 Minikube 已经成为 Docker Desktop 最简单的替代品。 Minikube 用于在本地环境中运行 Kubernetes 集群，但它也运行了一个可用于运行容器的 Docker 守护进程。如果你不需要使用 Kubernetes ，那么你可以通过 minikube pause 暂停 Kubernetes 相关镜像，从而解决系统资源。
在 macOS 上，Minikube 运行在很多虚拟化技术上，由于ISSUE-6296原因，本例使用 Virtualbox 方式（你需要先安装 Virtualbox）。
卸载 Docker Desktop for macOS 如果你之前安装过 Docker Desktop，那么你需要先卸载它
在 Docker Desktop 菜单中选择 Troubleshoot 并且选择 Uninstall. 删除 /Applications/Docker.app 安装 Docker CLI 因为卸载 Docker Desktop 后将自动卸载 Docker CLI，所以你需要单独安装
$ brew install docker $ brew install docker-compose 提示： 在执行 brew install docker-compose 命令的时候可能得到如下的失败信息，这是因为依赖包下载失败。你可以使用 brew install gdbm 单独下载依赖包，就避免了找不到依赖版本的错误。</p><a href=/posts/kubernetes/run-docker-without-docker-desktop-on-macos/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Mon, Feb 14, 2022</span>
<span class=separator><a class=category href=/categories/kubernetes/>kubernetes</a></span>
<span class=separator><a class=tag href=/tags/minikube/>minikube</a><a class=tag href=/tags/macos/>macOS</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/kubernetes/kubectl-commands/>Kubectl Commands</a></h3></div><div class=post-content><div class=p_part><p>常用 Kubectl 命令
创建命名空间 新建一个名为 nc-namespace.yaml 的 YAML 文件
apiVersion: v1 kind: Namespace metadata: name: nc-namespace 然后运行以下命令创建命名空间
$ kubectl create -f nc-namespace.yaml namespace/nc-namespace created 创建命名空间资源配额文件 新建一个名为 nc-quota.yaml 的 YAML 文件
apiVersion: v1 kind: ResourceQuota metadata: name: nc-quota namespace: nc-namespace spec: hard: pods: "10" requests.cpu: "2" requests.memory: 2Gi limits.cpu: "4" limits.memory: 4Gi 然后运行以下命令创建资源配额
$ kubectl create -f nc-quota.yaml resourcequota/nc-quota created 创建 PV 卷和 PVC 新建一个名为 nc-pv.</p><a href=/posts/kubernetes/kubectl-commands/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Dec 19, 2021</span>
<span class=separator><a class=category href=/categories/kubernetes/>kubernetes</a></span>
<span class=separator><a class=tag href=/tags/kubectl/>kubectl</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-kafka-cluster/>Automate Install Kafka Cluster with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 此脚本中的配置基于 Kafka 2.6.3 版本 使用 Kafka 发布包中自带的 Zookeeper 组件（通常这没有问题，除非你要将 Zookeeper 安装在单独的服务器上） 在 Kafka 安装目录下独立安装 JDK，目前只支持 Java 8 和 Java 11。 安装计划 服务器规划
IP SSH 端口 SSH 用户 SSH 密码 ROOT 密码 OS 10.1.207.177 22022 kafka 123456 root123 CentOS Linux release 7.9.2009 10.1.207.178 22022 kafka 123456 root123 CentOS Linux release 7.9.2009 10.1.207.183 22022 kafka 123456 root123 CentOS Linux release 7.</p><a href=/posts/ansible/ansible-kafka-cluster/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Thu, Dec 9, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/kafka/>kafka</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-antdb-distributed-cluster/>Automate Install AntDB Distributed Cluster with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 包含组件
MGR 集群的管理 GTM 全局事务管理 Coordinator 协调员管理用户会话 Data Node 数据节点 安装计划 服务器规划
IP SSH 端口 SSH 用户名 SSH 密码 ROOT 密码 OS 10.1.207.180 22022 antdb 123456 root123 CentOS Linux release 7.9.2009 10.1.207.181 22022 antdb 123456 root123 CentOS Linux release 7.9.2009 10.1.207.182 22022 antdb 123456 root123 CentOS Linux release 7.9.2009 提示： 可以参考批量自动化创建用户
集群节点规划
IP MGR GTM Coordinator DataNode 10.</p><a href=/posts/ansible/ansible-antdb-distributed-cluster/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Dec 5, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/antdb/>antdb</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-redis-master-slave-sentinel/>Automate Install Redis Master-Slave Sentinel with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 请先在目标服务器创建 redis 用户，此脚本在此用户下使用源代码编译的方式安装一主两从三哨兵的集群
安装计划 服务器规划
IP SSH 端口 SSH 用户名 SSH 密码 ROOT 密码 OS 10.1.207.180 22022 redis redis123 root123 CentOS Linux release 7.9.2009 10.1.207.181 22022 redis redis123 root123 CentOS Linux release 7.9.2009 10.1.207.182 22022 redis redis123 root123 CentOS Linux release 7.9.2009 提示： 可以参考批量自动化创建用户
集群节点规划
IP Redis Sentinel 10.</p><a href=/posts/ansible/ansible-redis-master-slave-sentinel/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Dec 5, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/redis/>redis</a><a class=tag href=/tags/sentinel/>sentinel</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/redis/redis-slowlog/>Slow LOG In Redis</a></h3></div><div class=post-content><div class=p_part><p>SLOWLOG 记录了 Redis 运行时间超时特定阀值的命令。这类慢查询命令被保存在 Redis 服务器的一个定长队列中，最多保存 slowlog-max-len(默认128）个慢查询命令。当慢查询命令达到128个时，新产生的慢查询被加入前，会从队列中删除最旧的慢查询命令。
配置 redis slowlog通过2个参数配置管理，默认命令耗时超过10毫秒，就会被记录到慢查询日志队列中；队列默认保存最近产生的128个慢查询命令。
slowlog-log-slower-than: 慢查询阀值，单位微秒，默认100000 (10毫秒)； 执行耗时超过这个值的查询会被记录；建议你生产环境设置为 10000（1毫秒），因为如果命令都是 1 毫秒以上，那么 Redis 吞吐率只有 1000 QPS；
slowlog-max-len: 慢查询存储的最大个数，默认128；生产设置设置大于1024，因为 slowlog 会省略过多的参数，慢查询不会占用过多的内存；
读取 返回最新的 2 条慢查询
SLOWLOG GET 2 1) 1) (integer) 9495 2) (integer) 1638760173 3) (integer) 13923 4) 1) "COMMAND" 5) "10.30.107.152:41830" 6) "" 2) 1) (integer) 9494 2) (integer) 1638759729 3) (integer) 17170 4) 1) "SADD" 2) "nc_oauth:uname_to_access:nc:vpengcheng" 3) "\xac\xed\x00\x05sr\x00Corg.</p><a href=/posts/redis/redis-slowlog/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Dec 5, 2021</span>
<span class=separator><a class=category href=/categories/redis/>redis</a></span>
<span class=separator><a class=tag href=/tags/redis/>redis</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-mysql-innodb-cluster/>Automate Install MySQL InnoDB Cluster with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 MySQL InnoDB Cluster 是 MySQL 团队为了高可用性 (HA) 目的而引入的。它为 MySQL 提供了完整的高可用解决方案。我将通过 Ansible Playbook 展示三个节点的 InnoDB 集群配置。
MySQL InnoDB 集群有以下服务组成
MySQL shell Group Replication ( GR ) MySQL Router 安装计划 服务器规划
IP地址 SSH 端口 SSH 用户名 SSH 密码 ROOT 密码 OS 10.1.207.180 22022 mysql 123456 root123 CentOS Linux release 7.9.2009 10.1.207.181 22022 mysql 123456 root123 CentOS Linux release 7.9.2009 10.</p><a href=/posts/ansible/ansible-mysql-innodb-cluster/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Nov 21, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/mysql/>mysql</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-elasticsearch-cluster/>Automate Install Elasticsearch Cluster with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 脚本会在此用户下安装三节点集群，因为 7.X 版本后会自带 JDK，所以我们不需要提前安装 Java 环境。
安装计划 服务器规划
IP地址 SSH 端口 SSH 用户名 SSH 密码 ROOT 密码 OS 10.1.207.180 22022 elasticsearch 123456 root123 CentOS Linux release 7.9.2009 10.1.207.181 22022 elasticsearch 123456 root123 CentOS Linux release 7.9.2009 10.1.207.182 22022 elasticsearch 123456 root123 CentOS Linux release 7.9.2009 提示： 可以参考批量自动化创建用户
集群节点规划
IP地址 Elasticsearch 10.</p><a href=/posts/ansible/ansible-elasticsearch-cluster/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Nov 7, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/elasticsearch/>elasticsearch</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/linux/linux-commands-search/>Linux Command - Grep</a></h3></div><div class=post-content><div class=p_part><p>使用正则表达式搜索文件内容 macOS
cat nc-auth_3000.log | grep -s 'timeCost":\d\d\d\d' centOS
cat nc-auth_3000.log | grep -P 'timeCost":\d\d\d\d' 使用正则表达式搜索压缩文件内容 macOS
gzip -dc nc-auth_3000.20211106.38.log.gz | grep -s 'timeCost":\d\d\d\d' centOS
gzip -dc nc-auth_3000.20211106.38.log.gz | grep -P 'timeCost":\d\d\d\d'</p></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Nov 7, 2021</span>
<span class=separator><a class=category href=/categories/linux/>linux</a></span>
<span class=separator><a class=tag href=/tags/linux/>linux</a><a class=tag href=/tags/grep/>grep</a></span></div></div></div></div><div class=pagination><ul class="pagination pagination-default"><li class=page-item><a href=/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/ aria-label="Page 1" class=page-link role=button>1</a></li><li class="page-item active"><a aria-current=page aria-label="Page 2" class=page-link role=button>2</a></li><li class=page-item><a href=/page/3/ aria-label="Page 3" class=page-link role=button>3</a></li><li class=page-item><a href=/page/4/ aria-label="Page 4" class=page-link role=button>4</a></li><li class=page-item><a href=/page/5/ aria-label="Page 5" class=page-link role=button>5</a></li><li class=page-item><a href=/page/3/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/6/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.f38354b14e726daea2b656ccc32c944fa1e10a974998cb85bbb50c0f836878b4.js integrity="sha256-84NUsU5yba6itlbMwyyUT6HhCpdJmMuFu7UMD4NoeLQ=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css integrity=sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js integrity=sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js integrity=sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v crossorigin=anonymous onload=renderMathInElement(document.body)></script></body></html>