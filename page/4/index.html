<!doctype html><html lang=en data-theme><head><title>Lei Zhang</title><meta charset=utf-8><meta name=generator content="Hugo 0.118.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="This is my knowledge base. I document things here"><link rel=stylesheet href=/css/style.min.7cf3c5090ac13256a5fa5531e5649cfe5a2ba7de88dca14ce0b6e253409a3511.css integrity="sha256-fPPFCQrBMlal+lUx5WSc/lorp96I3KFM4LbiU0CaNRE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.3fa691134fafa8351e9d193939a352647c1ae886828bdefa3f5a272653dbf7e4.css integrity="sha256-P6aRE0+vqDUenRk5OaNSZHwa6IaCi976P1onJlPb9+Q=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=/><link rel=alternate type=application/rss+xml href=/index.xml title><script type=text/javascript src=/js/anatole-header.min.df804b63b5bd8474ea0756ea874bc8f1e92552708cc6ea43aa0d76981dc419f9.js integrity="sha256-34BLY7W9hHTqB1bqh0vI8eklUnCMxupDqg12mB3EGfk=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="This is my knowledge base. I document things here"></head><body><div class="sidebar ."><div class=logo-title><div class=title><img src=/images/profile.jpg alt="profile picture"><h3 title><a href=/>I'm Lei Zhang</a></h3><div class=description><p>This is my knowledge base. I document things here</p></div></div><p><a href=https://github.com/coolbeevip><img src="https://img.shields.io/github/followers/coolbeevip?label=follow&amp;style=social" alt="GitHub coolbeevip"></a>
<img src=https://badges.pufler.dev/commits/all/coolbeevip alt="Commits Badge">
<img src=https://badges.pufler.dev/repos/coolbeevip alt="Repos Badge">
<img src=https://badges.pufler.dev/years/coolbeevip alt="Years Badge"></p></div><ul class=social-links><li><a href=https://github.com/coolbeevip/ rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:zhanglei@apache.org rel=me aria-label=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Lei Zhang 2023</div></div></div><div class=main><div class="page-top ."><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a class=current href=/ title>Home</a></li><li><a href=/posts title>Blog</a></li><li><a href=/bookmarks title>Bookmarks</a></li><li><a href=/about/ title>About</a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post ."></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-kafka-cluster/>Automate Install Kafka Cluster with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 此脚本中的配置基于 Kafka 2.6.3 版本 使用 Kafka 发布包中自带的 Zookeeper 组件（通常这没有问题，除非你要将 Zookeeper 安装在单独的服务器上） 在 Kafka 安装目录下独立安装 JDK，目前只支持 Java 8 和 Java 11。 安装计划 服务器规划
IP SSH 端口 SSH 用户 SSH 密码 ROOT 密码 OS 10.1.207.177 22022 kafka 123456 root123 CentOS Linux release 7.9.2009 10.1.207.178 22022 kafka 123456 root123 CentOS Linux release 7.9.2009 10.1.207.183 22022 kafka 123456 root123 CentOS Linux release 7.9.2009 提示： 可以参考批量自动化创建用户
集群节点规划
IP地址 Kafka Zookeeper Java 10.1.207.177 ✓ ✓ ✓ 10.</p><a href=/posts/ansible/ansible-kafka-cluster/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Thu, Dec 9, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/kafka/>kafka</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-antdb-distributed-cluster/>Automate Install AntDB Distributed Cluster with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 包含组件
MGR 集群的管理 GTM 全局事务管理 Coordinator 协调员管理用户会话 Data Node 数据节点 安装计划 服务器规划
IP SSH 端口 SSH 用户名 SSH 密码 ROOT 密码 OS 10.1.207.180 22022 antdb 123456 root123 CentOS Linux release 7.9.2009 10.1.207.181 22022 antdb 123456 root123 CentOS Linux release 7.9.2009 10.1.207.182 22022 antdb 123456 root123 CentOS Linux release 7.9.2009 提示： 可以参考批量自动化创建用户
集群节点规划
IP MGR GTM Coordinator DataNode 10.1.207.180 Master Master DataNode_Master_1, DataNode_Slave_3 10.1.207.181 Slave_1 Coordinator_1 DataNode_Master_2, DataNode_Slave_1 10.1.207.182 Slave_1 Coordinator_2 DataNode_Master_3, DataNode_Slave_2 节点安装路径</p><a href=/posts/ansible/ansible-antdb-distributed-cluster/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Dec 5, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/antdb/>antdb</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-redis-master-slave-sentinel/>Automate Install Redis Master-Slave Sentinel with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 请先在目标服务器创建 redis 用户，此脚本在此用户下使用源代码编译的方式安装一主两从三哨兵的集群
安装计划 服务器规划
IP SSH 端口 SSH 用户名 SSH 密码 ROOT 密码 OS 10.1.207.180 22022 redis redis123 root123 CentOS Linux release 7.9.2009 10.1.207.181 22022 redis redis123 root123 CentOS Linux release 7.9.2009 10.1.207.182 22022 redis redis123 root123 CentOS Linux release 7.9.2009 提示： 可以参考批量自动化创建用户
集群节点规划
IP Redis Sentinel 10.1.207.180 master ✓ 10.1.207.181 slave ✓ 10.1.207.182 slave ✓ 节点安装路径
路径 描述 /opt/redis 源代码上传路径 ~/redis_uninstall.sh 集群卸载脚本 ~/redis.sh Redis 启停脚本 ~/sentinel.sh Sentinel 启停脚本 /data01/redis/bin redis 编译后的程序 /data01/redis/log 日志目录 /data01/redis/data 数据目录 /data01/redis/conf 配置文件目录 下载安装包和 Playbook 脚本 在客户机上创建 playbook 脚本存放目录</p><a href=/posts/ansible/ansible-redis-master-slave-sentinel/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Dec 5, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/redis/>redis</a><a class=tag href=/tags/sentinel/>sentinel</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/redis/redis-slowlog/>Slow LOG In Redis</a></h3></div><div class=post-content><div class=p_part><p>SLOWLOG 记录了 Redis 运行时间超时特定阀值的命令。这类慢查询命令被保存在 Redis 服务器的一个定长队列中，最多保存 slowlog-max-len(默认128）个慢查询命令。当慢查询命令达到128个时，新产生的慢查询被加入前，会从队列中删除最旧的慢查询命令。
配置 redis slowlog通过2个参数配置管理，默认命令耗时超过10毫秒，就会被记录到慢查询日志队列中；队列默认保存最近产生的128个慢查询命令。
slowlog-log-slower-than: 慢查询阀值，单位微秒，默认100000 (10毫秒)； 执行耗时超过这个值的查询会被记录；建议你生产环境设置为 10000（1毫秒），因为如果命令都是 1 毫秒以上，那么 Redis 吞吐率只有 1000 QPS；
slowlog-max-len: 慢查询存储的最大个数，默认128；生产设置设置大于1024，因为 slowlog 会省略过多的参数，慢查询不会占用过多的内存；
读取 返回最新的 2 条慢查询
SLOWLOG GET 2 1) 1) (integer) 9495 2) (integer) 1638760173 3) (integer) 13923 4) 1) "COMMAND" 5) "10.30.107.152:41830" 6) "" 2) 1) (integer) 9494 2) (integer) 1638759729 3) (integer) 17170 4) 1) "SADD" 2) "nc_oauth:uname_to_access:nc:vpengcheng" 3) "\xac\xed\x00\x05sr\x00Corg.springframework.security.oauth2.common.DefaultOAuth2AccessToken\x0c\xb2\x9e6\x1b$\xfa\xce\x02\x00\x06L\x00\x15additionalInformationt\x00\x0fLjava/util/Map;... (9974 more bytes)" 5) "10.</p><a href=/posts/redis/redis-slowlog/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Dec 5, 2021</span>
<span class=separator><a class=category href=/categories/redis/>redis</a></span>
<span class=separator><a class=tag href=/tags/redis/>redis</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-mysql-innodb-cluster/>Automate Install MySQL InnoDB Cluster with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 MySQL InnoDB Cluster 是 MySQL 团队为了高可用性 (HA) 目的而引入的。它为 MySQL 提供了完整的高可用解决方案。我将通过 Ansible Playbook 展示三个节点的 InnoDB 集群配置。
MySQL InnoDB 集群有以下服务组成
MySQL shell Group Replication ( GR ) MySQL Router 安装计划 服务器规划
IP地址 SSH 端口 SSH 用户名 SSH 密码 ROOT 密码 OS 10.1.207.180 22022 mysql 123456 root123 CentOS Linux release 7.9.2009 10.1.207.181 22022 mysql 123456 root123 CentOS Linux release 7.9.2009 10.1.207.182 22022 mysql 123456 root123 CentOS Linux release 7.9.2009 提示： 可以参考批量自动化创建用户
集群节点规划</p><a href=/posts/ansible/ansible-mysql-innodb-cluster/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Nov 21, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/mysql/>mysql</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ansible/ansible-elasticsearch-cluster/>Automate Install Elasticsearch Cluster with Ansible Playbook</a></h3></div><div class=post-content><div class=p_part><p>集群概述 脚本会在此用户下安装三节点集群，因为 7.X 版本后会自带 JDK，所以我们不需要提前安装 Java 环境。
安装计划 服务器规划
IP地址 SSH 端口 SSH 用户名 SSH 密码 ROOT 密码 OS 10.1.207.180 22022 elasticsearch 123456 root123 CentOS Linux release 7.9.2009 10.1.207.181 22022 elasticsearch 123456 root123 CentOS Linux release 7.9.2009 10.1.207.182 22022 elasticsearch 123456 root123 CentOS Linux release 7.9.2009 提示： 可以参考批量自动化创建用户
集群节点规划
IP地址 Elasticsearch 10.1.207.180 ✓ 10.1.207.181 ✓ 10.1.207.182 ✓ 节点安装路径
路径 描述 /opt/elasticsearch 程序安装路径 ~/elasticsearch_uninstall.sh 集群卸载脚本 ~/elasticsearch.sh 集群启停脚本 /data01/elasticsearch/logs 日志文件 /data01/elasticsearch/data 数据文件 /data01/elasticsearch/dump DUMP 文件 /data01/elasticsearch/temp 临时文件 下载安装包和 Playbook 脚本 在你的笔记本上创建 playbook 脚本存放目录</p><a href=/posts/ansible/ansible-elasticsearch-cluster/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Nov 7, 2021</span>
<span class=separator><a class=category href=/categories/ansible/>ansible</a></span>
<span class=separator><a class=tag href=/tags/ansible/>ansible</a><a class=tag href=/tags/elasticsearch/>elasticsearch</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/linux/linux-commands-search/>Linux Command - Grep</a></h3></div><div class=post-content><div class=p_part><p>使用正则表达式搜索文件内容 macOS
cat nc-auth_3000.log | grep -s 'timeCost":\d\d\d\d' centOS
cat nc-auth_3000.log | grep -P 'timeCost":\d\d\d\d' 使用正则表达式搜索压缩文件内容 macOS
gzip -dc nc-auth_3000.20211106.38.log.gz | grep -s 'timeCost":\d\d\d\d' centOS
gzip -dc nc-auth_3000.20211106.38.log.gz | grep -P 'timeCost":\d\d\d\d'</p></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Nov 7, 2021</span>
<span class=separator><a class=category href=/categories/linux/>linux</a></span>
<span class=separator><a class=tag href=/tags/linux/>linux</a><a class=tag href=/tags/grep/>grep</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/java/java-undertow-threads-and-jdbc-pools/>The Impact of Undertow Thread Options & Database Connection Pool on Performance</a></h3></div><div class=post-content><div class=p_part><p>Hikari 线程参数和数据库连接池参数对业务吞吐率的影响分析
场景 本例中我们使用 Undertow 作为 Web 容器，使用 Hikari 作为数据库连接池， 并通过 spring.datasource.hikari.maximum-pool-size 和 server.undertow.threads.worker 两个参数的调整，看看对于业务的性能影响有多大
为此我准备了一个简单的 DEMO，并且执行 1000 次请求，并发 100，每次请求执行一个 SLEEP(5) 的 SQL模拟单笔耗时。并在一个 2C 的服务器上测试。应用默认参数如下
spring.datasource.hikari.connection-timeout=30000 spring.datasource.hikari.minimum-idle=10 spring.datasource.hikari.maximum-pool-size=10 server.undertow.threads.worker(默认是 2C*8) 默认参数 $ ab -c 100 -n 1000 http://localhost:6060/test This is ApacheBench, Version 2.3 &lt;$Revision: 1879490 $> Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/ Licensed to The Apache Software Foundation, http://www.apache.org/ Benchmarking localhost (be patient) Completed 100 requests Completed 200 requests Completed 300 requests Completed 400 requests Completed 500 requests Completed 600 requests Completed 700 requests Completed 800 requests Completed 900 requests Completed 1000 requests Finished 1000 requests Server Software: Server Hostname: localhost Server Port: 6060 Document Path: /test Document Length: 14 bytes Concurrency Level: 100 Time taken for tests: 510.</p><a href=/posts/java/java-undertow-threads-and-jdbc-pools/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Thu, Sep 23, 2021</span>
<span class=separator><a class=category href=/categories/java/>java</a></span>
<span class=separator><a class=tag href=/tags/undertow/>undertow</a><a class=tag href=/tags/hikari/>hikari</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/redis/redis-find-biggest-objects-in-redis/>Find The Biggest Objects In Redis</a></h3></div><div class=post-content><div class=p_part><p>在 REDIS 中一个字符串最大512MB，一个二级数据结构（例如hash、list、set、zset）可以存储大约40亿个(2^32-1)个元素，但实际上中如果下面两种情况，我就会认为它是 bigkeys。
字符串类型：单个 value 超过5MB 哈希、列表、集合、有序集合元素可数超过 10000 因为 REDIS 是单进程处理，所以对 BIGKEY 的访问会产生阻塞，如果你获取 100 次单体大小为 5MB 的 KEY，那么这些数据（500MB）传输到客户端就需要一定的时间，这期间其他命令都要排队等待。
查找 BIGKEY 使用 bigkeys 命令可以统计大对象（建议在从结点执行），为了方式阻塞，我们设置一个休眠参数 -i 0.1
redis-cli -h &lt;ip> -p &lt;port> -a &lt;password> --bigkeys -i 0.1 结果如下：
$ redis-cli -h 192.168.51.207 -p 9015 --bigkeys Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. # Scanning the entire keyspace to find biggest keys as well as # average sizes per key type.</p><a href=/posts/redis/redis-find-biggest-objects-in-redis/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Wed, Aug 25, 2021</span>
<span class=separator><a class=category href=/categories/redis/>redis</a></span>
<span class=separator><a class=tag href=/tags/redis/>redis</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/git/git-multiple-ssh-keys/>Multiple SSH Keys Settings For Different Git Platform[Github、Gitlab]</a></h3></div><div class=post-content><div class=p_part><p>我们在使用 Github、Gitlab 或者 JetBrains Space 时通常使用 SSH 密钥可以连接 Git 服务，而无需在每次访问时都提供用户名和个人访问令牌。 另外现在大量平台启用账户登录多次验证，也促进我们避免使用账号密码登录。
为了便于管理我们通常会为每个 Git 平台配置不同的 SSH KEY，然后通过 ~/.ssh/config 配置每个平台对应的 SSH KEY。
创建多个 SSH KEY 使用如下命令创建 id_github，注意提示输入文件名时请修改成 id_github
ssh-keygen -t ed25519 -C "coolbeevip@github.com" 使用同样的方法我们分别创建 id_gitlab 和 id_github，这时在的本地的 ~/.ssh 目录下会得到如下文件
id_github(私钥)、id_github.pub(公钥) id_gitlab(私钥)、id_gitlab.pub(公钥) 将 *.pub 文件内容分别导入到 Git 服务中，详细方式请参考 Github and SSH keys 、 GitLab and SSH keys 或 JetBrains Space and SSH keys
配置 SSH 编辑 ~/.ssh/config 文件为每个 Git 地址配置不同的私钥
Host github.com ServerAliveInterval 60 UseKeychain yes IdentityFile ~/.</p><a href=/posts/git/git-multiple-ssh-keys/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Sun, Aug 22, 2021</span>
<span class=separator><a class=category href=/categories/git/>git</a></span>
<span class=separator><a class=tag href=/tags/git/>git</a></span></div></div></div></div><div class=pagination><ul class="pagination pagination-default"><li class=page-item><a href=/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/3/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/page/2/ aria-label="Page 2" class=page-link role=button>2</a></li><li class=page-item><a href=/page/3/ aria-label="Page 3" class=page-link role=button>3</a></li><li class="page-item active"><a aria-current=page aria-label="Page 4" class=page-link role=button>4</a></li><li class=page-item><a href=/page/5/ aria-label="Page 5" class=page-link role=button>5</a></li><li class=page-item><a href=/page/6/ aria-label="Page 6" class=page-link role=button>6</a></li><li class=page-item><a href=/page/5/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/8/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.e1c6918cbaa90022a5612f0bd71c7bf3be6d036614c5729cebfe14f7b91fa4bc.js integrity="sha256-4caRjLqpACKlYS8L1xx7875tA2YUxXKc6/4U97kfpLw=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css integrity=sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js integrity=sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js integrity=sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v crossorigin=anonymous onload=renderMathInElement(document.body)></script></body></html>