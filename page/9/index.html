<!doctype html><html lang=en data-theme><head><title>Lei Zhang </title><meta charset=utf-8><meta name=generator content="Hugo 0.123.3"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="This is my knowledge base. I document things here"><link rel=stylesheet href=/css/style.min.7cf3c5090ac13256a5fa5531e5649cfe5a2ba7de88dca14ce0b6e253409a3511.css integrity="sha256-fPPFCQrBMlal+lUx5WSc/lorp96I3KFM4LbiU0CaNRE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.d03676fac5605f1e95639c8b2239ea77daf8804fe13da2208bb83b252959846c.css integrity="sha256-0DZ2+sVgXx6VY5yLIjnqd9r4gE/hPaIgi7g7JSlZhGw=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=/><link rel=alternate type=application/rss+xml href=/index.xml title><script type=text/javascript src=/js/anatole-header.min.df804b63b5bd8474ea0756ea874bc8f1e92552708cc6ea43aa0d76981dc419f9.js integrity="sha256-34BLY7W9hHTqB1bqh0vI8eklUnCMxupDqg12mB3EGfk=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="This is my knowledge base. I document things here"></head><body><div class="sidebar ."><div class=logo-title><div class=title><img src=/images/profile.jpg alt="profile picture"><h3 title><a href=/>I'm Lei Zhang</a></h3><div class=description><p>This is my knowledge base. I document things here</p></div></div><p><a href=https://github.com/coolbeevip><img src="https://img.shields.io/github/followers/coolbeevip?label=follow&amp;style=social" alt="GitHub coolbeevip"></a>
<img src=https://badges.pufler.dev/commits/all/coolbeevip alt="Commits Badge">
<img src=https://badges.pufler.dev/repos/coolbeevip alt="Repos Badge">
<img src=https://badges.pufler.dev/years/coolbeevip alt="Years Badge"></p></div><ul class=social-links><li><a href=https://github.com/coolbeevip/ rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=mailto:zhanglei@apache.org rel=me aria-label=e-mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Lei Zhang 2025</div></div></div><div class=main><div class="page-top ."><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a><ul class=nav id=navMenu><li><a class=current href=/ title>Home</a></li><li><a href=/posts title>Blog</a></li><li><a href=/bookmarks title>Bookmarks</a></li><li><a href=/about/ title>About</a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post ."></div><div class="post ."><div class=post-title><h3><a href=/posts/docker/docker-commands/>Docker Commands</a></h3></div><div class=post-content><div class=p_part><p>常用 Docker 命令记录
镜像 镜像列表按照大小排序 docker images --format "{{.ID}}\t{{.Size}}\t{{.Repository}}" | sort -k 2 -h 删除所有镜像 docker rmi -f $(docker images | awk '{print $3}') 删除所有 dangling 镜像 docker rmi -f $(docker images -a | grep "&lt;none>" | awk '{print $3}') 导出镜像 docker save -o postgres_9.6.tar postgres:9.6 docker save postgres:9.6 | gzip > postgres_9.6.tar 导入镜像 docker load -i postgres_9.6.tar 容器 删除所有 Exited 容器 docker rm $(docker ps -a | grep Exited | awk '{print $1}') 停止并删除所有容器 docker stop $(docker ps | awk '{print $1}') docker rm -f $(docker ps -a | awk '{print $1}') 停止 dead 容器 删除实例时提示 device or resource busy</p><a href=/posts/docker/docker-commands/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Wed, Feb 6, 2019
</span><span class=separator><a class=category href=/categories/docker/>docker</a></span>
<span class=separator><a class=tag href=/tags/docker/>docker</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/flyway/flyway-hung-on-mysql-router-mgr/>Flyway hung on the MySQL Router + MGR</a></h3></div><div class=post-content><div class=p_part><p>Flyway 连接 MySQL Router 后启动卡在 GET_LOCK 语句
现象 MySQL MGR + Router 部署高可用集群 Flyway 客户端使用 jdbc:mysql:loadbalance 连接 初始化 Schema History 表、或者执行多个 SQL 脚本时 当满足以上条件时，Flyway 会卡在初始化阶段，经过分析发现停顿在执行 GET_LOCK 语句时
原因 Flyway 默认在执行 DDL 脚本时不启用事务，在初始化时 Flyway 会先执行 GET_LOCK 锁定数据库，然后再执行 DDL 脚本。当使用 jdbc:mysql:loadbalance 连接时，会随机选择一个数据源，如果执行 GET_LOCK 和 执行 DDL 不是一个数据源，就会导致执行等待锁释放
解决办法 在启动时设置 group=true 参数，这样 Flyway 在初始化时就会启用事务，确保一个事务内的 DDL 都在一个数据源执行
ISSUE-3154
public class FlywayTestManual { String url="jdbc:mysql:loadbalance://192.168.51.206:3810,192.168.51.207:3810/nc_notifier?roundRobinLoadBalance=false&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=GMT%2B8&amp;allowMultiQueries=true&amp;allowPublicKeyRetrieval=true"; String user="user"; String password="pass"; @Test public void test(){ Flyway flyway = Flyway.</p><a href=/posts/flyway/flyway-hung-on-mysql-router-mgr/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Thu, Nov 29, 2018
</span><span class=separator><a class=category href=/categories/java/>java</a></span>
<span class=separator><a class=tag href=/tags/java/>java</a><a class=tag href=/tags/flyway/>flyway</a><a class=tag href=/tags/mysql/>mysql</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/flyway/java-flyway-support-oracle/>Flyway Support Oracle</a></h3></div><div class=post-content><div class=p_part><p>记录在使用 Flyway 管理 Oracle 数据库脚本时遇到的一些问题，Flyway 5.2.1 - 7.7.3 都存在此问题。
1. Flyway not support Oracle 11g 异常信息
Caused by: org.flywaydb.core.internal.license.FlywayEditionUpgradeRequiredException: Flyway Enterprise Edition or Oracle upgrade required: Oracle 11.2 is no longer supported by Flyway Community Edition, but still supported by Flyway Enterprise Edition. at org.flywaydb.core.internal.database.base.Database.ensureDatabaseNotOlderThanOtherwiseRecommendUpgradeToFlywayEdition(Database.java:173) at org.flywaydb.core.internal.database.oracle.OracleDatabase.ensureSupported(OracleDatabase.java:91) at org.flywaydb.core.Flyway.execute(Flyway.java:514) at org.flywaydb.core.Flyway.migrate(Flyway.java:159) at org.springframework.boot.autoconfigure.flyway.FlywayMigrationInitializer.afterPropertiesSet(FlywayMigrationInitializer.java:65) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1855) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1792) ... 19 common frames omitted 修改 Flyway 5.2.4 OracleDatabase.java 社区版本做了版本号限制 修改 Flyway 6.5.7 OracleDatabase.</p><a href=/posts/flyway/java-flyway-support-oracle/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Thu, Nov 29, 2018
</span><span class=separator><a class=category href=/categories/java/>java</a></span>
<span class=separator><a class=tag href=/tags/java/>java</a><a class=tag href=/tags/flyway/>flyway</a><a class=tag href=/tags/oracle/>oracle</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/flyway/java-flyway-merge-script-step/>To roll up Flyway incremental changes into 1 file</a></h3></div><div class=post-content><div class=p_part><p>Flyway 通过 SQL Patch 脚本的方式管理数据库脚本版本，开发一段时间后会积攒大量脚本。当一个版本稳定后我们希望合并成一个全量脚本
1.首先对齐程序与数据库中的脚本版本号 查看程序中脚本版本清单，例如：程序中有三个版本的脚本
V1.0.0.0__init.sql V1.0.0.1__add_user_table.sql V1.0.0.2__modify_user_table.sql 查看数据库中历史版本记录表 (默认是 flyway_schema_history) 中执行过的脚本版本，例如：
versions description script success 1.0.0.0 init.sql V1.0.0.0__init.sql 1 1.0.0.1 add_user_table.sql V1.0.0.1__add_user_table.sql 1 1.0.0.2 modify_user_table V1.0.0.2__modify_user_table.sql 1 这里只摘取了关键字段，你可以看到每个版本都已经执行，并且执行都是成功的 success=1
至此：你已经对齐了程序和数据库中脚本版本号，可以开始准备合并了
2.合并程序中的SQL脚本 合并多个脚本的内容到最大版本号的文件中，例如：将 V1.0.0.0__init.sql, V1.0.0.1__add_user_table.sql, V1.0.0.2__modify_user_table.sql 合并为 V1.0.0.2__init.sql
注意： 不是简单的文件合并，而是最终执行结果的合并
3.重新打包程序 只包含合 V1.0.0.2__init.sql 脚本的程序
4.停止所有老版本的程序 包含 V1.0.0.0__init.sql,V1.0.0.1__add_user_table.sql,V1.0.0.2__modify_user_table.sql 老脚本的程序
5.删除数据库中的版本历史表 默认是 flyway_schema_history
6.重启应用程序 在程序启动时设置基线版本参数为当前版本，设置这个参数的目的是告诉 Flyway 当前已经执行过 1.0.0.2 脚本了。这之前的脚本不要再执行了。
flyway.baseline-version=1.0.0.2 注意： 如果是空库，全新安装程序，那么则不需要设置 flyway.baseline-version 参数
7.结束 查看数据库中历史版本记录表 (默认是 flyway_schema_history) 中执行过的脚本版本，例如：
versions description script success 1.</p><a href=/posts/flyway/java-flyway-merge-script-step/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Thu, Nov 29, 2018
</span><span class=separator><a class=category href=/categories/java/>java</a></span>
<span class=separator><a class=tag href=/tags/java/>java</a><a class=tag href=/tags/flyway/>flyway</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/maven/maven-commands/>Maven Commands</a></h3></div><div class=post-content><div class=p_part><p>常用 Maven 命令
Parameters -D 指定参数，如 -Dmaven.test.skip=true 跳过单元测试； -P 指定 Profile 配置，可以用于区分环境； -e 显示maven运行出错的信息； -o 离线执行命令,即不去远程仓库更新包； -f 强制指定使用 POM 文件，或者包含 POM 文件的目录 -pl 选项后可跟随{groupId}:{artifactId}或者所选模块的相对路径(多个模块以逗号分隔) -am 表示同时处理选定模块所依赖的模块 -amd 表示同时处理依赖选定模块的模块 -rf 表示从指定模块开始继续处理 -N 表示不递归子模块 -X 显示maven允许的debug信息； -U 强制去远程更新 snapshot的插件或依赖，默认每天只更新一次。 &ndash;no-snapshot-updates 禁止更新 snapshot Dependency 显示maven依赖数
mvn dependency:tree 显示maven依赖列表
mvn dependency:list 下载依赖包的源码
mvn dependency:sources Maven Wrapper 自动安装 maven 的包装器（适合不想手动安装Maven的用户），使用插件Maven Wrapper plugin将其自动化安装指定版本的 Maven
mvn -N io.takari:maven:wrapper -Dmaven=3.6.3 这个命令会在你的项目中生成如下文件，请将这些文件与源代码一起管理
mvnw: 这是 Linux Script 可执行文件，用来代替 mvn mvnw.cmd: 这是 Windows Script 可执行文件，用来代替 mvn mvn: 隐藏的文件夹，其中包含Maven Wrapper Java库及其属性文件 首次执行 mvnw 或者 mvnw.</p><a href=/posts/maven/maven-commands/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Fri, Nov 23, 2018
</span><span class=separator><a class=category href=/categories/java/>java</a></span>
<span class=separator><a class=tag href=/tags/maven/>maven</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/stress-testing-host-estimate-with-qps/>Estimate host capacity based on QPS</a></h3></div><div class=post-content><div class=p_part><p>通过单个服务器压测的 QPS 估算需要的服务器数量
已知 QPS 和期望每笔耗时，估算服务器数量 服务器数量 $$ = QPS \div (1000 \div 每笔毫秒) \div 每服务器CPU个数 $$
例如：
QPS：每秒处理3200笔 每笔毫秒：50ms 每个服务器CPU个数：16 服务器数量 $$ 3200_{qps} \div (1000_{ms} \div 50_{ms}) \div 16_{cpu} = 10_{台} $$
已知 QPS 以及服务器数量，估算每笔耗时 每笔耗时毫秒 $$ = 1000 \div ( QPS \div ( 服务器数量 \times 每服务器CPU个数 ) ) $$
例如：
QPS：每秒处理3200笔 服务器数量：10 每服务器CPU个数：16 每笔耗时毫秒 $$ 1000 \div ( 3200 \div ( 10 \times 16 ) ) = 50_{ms}$$</p></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Wed, Mar 7, 2018
</span><span class=separator><a class=category href=/categories/stress/>stress</a></span>
<span class=separator><a class=tag href=/tags/stress/>stress</a><a class=tag href=/tags/test/>test</a><a class=tag href=/tags/qps/>qps</a></span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/ai/camel-database-agent-en/></a></h3></div><div class=post-content><div class=p_part><p>Pain Points in Data Analysis and Solutions In today&rsquo;s data-driven business environment, a common scenario is: business analysts urgently need certain data analysis but must wait for technical team members who know SQL to provide support. According to a McKinsey study, analysts spend an average of 30-40% of their time just on data preparation and query construction. This dependency not only delays the decision-making process but also increases the workload of the technical team.</p><a href=/posts/ai/camel-database-agent-en/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Mon, Jan 1, 0001</span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/english/ket-unit10/></a></h3></div><div class=post-content><div class=p_part><p>KET UNIT10 WORDS 中文 英文 中文 英文 海滩 beach 沙漠 desert 森林 forest 岛 islands 湖泊 lake 高山 mountain 最深的 the deepest 最长的 the longest 最高的 the highest 最多的 the most 最大的 the biggest 最热的 the hottest 活动 activity 在机场 at the airport 在欧洲 in Europe 在世界上 in the world HOMEWORK 2024/01/03
完成 Unit10 练习册。 背诵PB P73 Reading Part2 Holiday Activities.默写并校准</p></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Mon, Jan 1, 0001</span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/english/ket-unit3/></a></h3></div><div class=post-content><div class=p_part><p>KET UNIT3 1. Grammar Countable nouns How many 用于询问可数名词的数量 a few 修饰可数名词复数，表肯定意义，有一些，不是那么多; few 表否定意义，几乎没有 quite a few表示不少, 相当多 Uncountable nouns How much 用于问不可数名词的数量 a little 修饰不可数名词，表肯定意义，有一点儿 little 表否定意义，几乎没有 Countable nouns and Uncountable nouns a lot of 很多 no 没有 2. Plurals of nouns 1. 大多数名词在末尾加s：
book-books chair-chairs cat-cats 2. 以s、x、ch、sh、o结尾的名词，在末尾加es：
bus-buses class-classes glass-glasses match-matches watch-watches dish-dishes brush-brushes box-boxes fox-foxes half-halves 但也有例外，如photo-photos 3. 以辅音字母+y结尾的名词，把y变为i，再加es：
fly-flies city-cities baby-babies 4. 以f或fe结尾的名词，大多数情况下变为v，并加es：
leaf-leaves knife-knives wife-wives family-families 5.</p><a href=/posts/english/ket-unit3/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Mon, Jan 1, 0001</span></div></div></div></div><div class="post ."><div class=post-title><h3><a href=/posts/english/ket-unit4/></a></h3></div><div class=post-content><div class=p_part><p>KET UNIT4 1. Grammar Present Continuous 现在进行时，句子结构为 主语 + 助动词 "be" + 现在分词（动词-ing 形式）, 例如： I am studying(我正在学习) I am studying for my exam(我正在为考试而学习) She is not working today(她今天不工作) What are you doing(你正在做什么) Present Simple 一般现在时，句子结构为 主语 + 谓语动词 I eat breakfast every day(我每天吃早饭) She does not like coffee(他不喜欢咖啡) Do they play tennis on Sundays?(他们星期日打网球吗) 2. Present participle(动词现在分词) 1. 一般规律：大多数动词的现在分词形式是在动词原形（即第一形式）后加-ing：
play-playing read-reading sing-singing 2. 以不发音的字母 e 结尾的动词，去掉 e，再加-ing：
make-making write-writing dance-dancing 但有一些例外，如 be-being 3.</p><a href=/posts/english/ket-unit4/ class=read_more>Read more</a></div></div><div class=post-footer><div class=meta><div class=info><em class="fas fa-calendar-day"></em>
<span class=date>Mon, Jan 1, 0001</span></div></div></div></div><div class=pagination><ul class="pagination pagination-default"><li class=page-item><a href=/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/page/8/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/page/7/ aria-label="Page 7" class=page-link role=button>7</a></li><li class=page-item><a href=/page/8/ aria-label="Page 8" class=page-link role=button>8</a></li><li class="page-item active"><a aria-current=page aria-label="Page 9" class=page-link role=button>9</a></li><li class=page-item><a href=/page/10/ aria-label="Page 10" class=page-link role=button>10</a></li><li class=page-item><a href=/page/11/ aria-label="Page 11" class=page-link role=button>11</a></li><li class=page-item><a href=/page/10/ aria-label=Next class=page-link role=button><span aria-hidden=true>&#187;</span></a></li><li class=page-item><a href=/page/11/ aria-label=Last class=page-link role=button><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.e1c6918cbaa90022a5612f0bd71c7bf3be6d036614c5729cebfe14f7b91fa4bc.js integrity="sha256-4caRjLqpACKlYS8L1xx7875tA2YUxXKc6/4U97kfpLw=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css integrity=sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js integrity=sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js integrity=sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v crossorigin=anonymous onload=renderMathInElement(document.body)></script></body></html>